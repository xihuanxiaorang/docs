# æ³¨è§£é©±åŠ¨å¼€å‘

é¢å‘ Spring å¼€å‘å·²ç»é€æ¸ä»ç¹ççš„ XML é…ç½®æ–‡ä»¶å‘å±•åˆ°ç®€å•å¥½ç”¨çš„æ³¨è§£é©±åŠ¨æ¨¡å¼ï¼Œå°¤å…¶æ˜¯åœ¨ SpringBoot è¿™æ ·ä¸€æ¬¾å¿«é€Ÿå¼€å‘è„šæ‰‹æ¶ä¸­ï¼Œåº•å±‚å¤§é‡ä½¿ç”¨æ³¨è§£å®Œæˆå„ç§å„æ ·çš„é«˜çº§åŠŸèƒ½ï¼Œå› æ­¤éå¸¸æœ‰å¿…è¦æ•´ç†ä¸‹ Spring/SpringBoot æä¾›çš„å¸¸ç”¨æ³¨è§£ã€‚ä¸ºäº†ä¾¿äºè®°å¿†ï¼Œå°†å¸¸ç”¨çš„æ³¨è§£åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

## ç»„ä»¶æ³¨å†Œ

### @Configuration + @Bean

1. ç¯å¢ƒæ­å»ºï¼šåˆ›å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ï¼ˆä»¥ä¸‹æ³¨è§£éƒ½åŸºäºè¯¥é¡¹ç›®è¿›è¡Œæ¼”ç¤ºå’Œæµ‹è¯•ï¼‰ï¼Œç”¨äºæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ @Configuration å’Œ @Bean æ³¨è§£å‘ IoC å®¹å™¨ä¸­æ³¨å…¥ç»„ä»¶ã€‚

   1. å…ˆå®šä¹‰ Person å’Œ Pet ä¸¤ä¸ªæ™®é€šçš„ POJO ç±»ï¼›

      ```java
      public class Person {
          private String name;
          private Integer age;
          private Pet pet;
      
          public Person() {
          }
      
          public Person(String name, Integer age, Pet pet) {
              this.name = name;
              this.age = age;
              this.pet = pet;
          }
      
          public String getName() {
              return name;
          }
      
          public void setName(String name) {
              this.name = name;
          }
      
          public Integer getAge() {
              return age;
          }
      
          public void setAge(Integer age) {
              this.age = age;
          }
      
          public Pet getPet() {
              return pet;
          }
      
          public void setPet(Pet pet) {
              this.pet = pet;
          }
      }
      ```

      ```java
      public class Pet {
          private String name;
          private Integer age;
      
          public Pet() {
          }
      
          public Pet(String name, Integer age) {
              this.name = name;
              this.age = age;
          }
      
          public String getName() {
              return name;
          }
      
          public void setName(String name) {
              this.name = name;
          }
      
          public Integer getAge() {
              return age;
          }
      
          public void setAge(Integer age) {
              this.age = age;
          }
      }
      ```

      2. å†å®šä¹‰ç”± @Configuration æ³¨è§£æ ‡æ³¨çš„ MainConfig ä¸»é…ç½®ç±»ï¼Œåœ¨è¯¥ç±»ä¸­å­˜åœ¨ä¸¤ä¸ªç”± @Bean æ³¨è§£çš„æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›å€¼çš„ç±»å‹åˆ†åˆ«ä¸º Person å’Œ Petï¼›

         ```java
         @Configuration
         public class MainConfig {
             @Bean
             public Person person() {
                 return new Person("xiaorang", 18, pet());
             }
         
             @Bean
             public Pet pet() {
                 return new Pet("xiaobai", 2);
             }
         }
         ```

      3. åˆ›å»ºæµ‹è¯•ç±» ApiTest

         ```java
         @SpringBootTest
         public class ApiTest {
             @Test
             public void test_00(ApplicationContext applicationContext) {
                 Person person = applicationContext.getBean(Person.class);
                 Pet pet = applicationContext.getBean(Pet.class);
                 System.out.println(person);
                 System.out.println(person.getPet());
                 System.out.println(pet);
             }
         }
         ```

         è¯¥æµ‹è¯•ç±»ä¸Šæ ‡æ³¨ @SpringBootTest æ³¨è§£ï¼Œè¯¥æ³¨è§£ä¸€èˆ¬ç”¨äºé›†æˆæµ‹è¯•ï¼Œé»˜è®¤ä¼šåŠ è½½å®Œæ•´çš„ Spring åº”ç”¨ç¨‹åºå¹¶æ³¨å†Œæ‰€æœ‰çš„å•å®ä¾‹ Beanï¼›

         1. åœ¨è¯¥æµ‹è¯•ç±»ä¸­å¯ä»¥é€šè¿‡è‡ªåŠ¨è£…é…ï¼ˆä½¿ç”¨ @Autowired/@Resource/@Inject æ³¨è§£ï¼‰ç»™å±æ€§èµ‹å€¼ï¼Œä½¿ç”¨æ–¹å¼ä¸æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­çš„ Controller ä¾èµ– Service ä¸€è‡´ï¼
         2. å¦å¤–ä¸€ç§ä½¿ç”¨æ–¹å¼å¦‚ä¸Šç¤ºä¾‹æ‰€ç¤ºï¼Œå°†å±æ€§ä½œä¸ºæµ‹è¯•æ–¹æ³•çš„å‚æ•°ï¼Œå‚æ•°å€¼å°†ç”± IoC å®¹å™¨è‡ªåŠ¨æ³¨å…¥ï¼æœ‰ç‚¹ç±»ä¼¼äºæ„é€ å‚æ•°æ³¨å…¥çš„æ–¹å¼

         æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![278a7eb7-a00a-4f3d-9171-72a0c1593902](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252242109.png)

2. ç»†èŠ‚åˆ†æï¼š

   1. å½“ä½¿ç”¨ @Configuration æ³¨è§£æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šæ—¶ï¼Œè¡¨ç¤ºè¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå…¶ä½œç”¨æ˜¯ä»£æ›¿ XML é…ç½®æ–‡ä»¶ï¼›å…¶å® @Configuration æ³¨è§£æœ¬è´¨ä¸Šä»»ç„¶æ˜¯ä¸€ä¸ª @Component æ³¨è§£ï¼Œæ‰€ä»¥è¢« @Configuration æ³¨è§£æ ‡æ³¨çš„ç±»ä¹Ÿä¼šè¢«æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼›
   2. åœ¨é…ç½®ç±»ä¸­çš„æŸä¸ªæ–¹æ³•ä¸Šæ ‡æ³¨ @Bean æ³¨è§£è¡¨ç¤ºä¼šå°†è¯¥æ–¹æ³•è¿”å›çš„å®ä¾‹å¯¹è±¡æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼ˆé€šç”¨çš„ factory-method æœºåˆ¶ï¼‰ï¼Œå…¶ä½œç”¨æ˜¯ä»£æ›¿ XML é…ç½®æ–‡ä»¶ä¸­çš„ bean æ ‡ç­¾ï¼›å…¶ä¸­æ³¨å†Œè¿› IoC å®¹å™¨ä¸­çš„ Bean çš„ç±»å‹ä¸ºæ–¹æ³•çš„è¿”å›å€¼ï¼Œid é»˜è®¤ä¸ºæ–¹æ³•åï¼Œä¸è¿‡å¯ä»¥é€šè¿‡æ³¨è§£ä¸­çš„ name æˆ–è€… value å±æ€§ä¿®æ”¹ï¼›â— å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ä¸­çš„å‚æ•°ä¼šç”± IoC å®¹å™¨è‡ªåŠ¨æ³¨å…¥ï¼

3. é…ç½®ç±»çš„ FULL & LITE æ¨¡å¼

   1. FULL æ¨¡å¼ï¼šæ˜¯æŒ‡é…ç½®ç±»ä¸Šæ ‡æ³¨çš„ @Configuration æ³¨è§£ä¸­çš„ proxyBeanMethods å±æ€§ç¼ºçœï¼ˆé»˜è®¤ï¼‰æˆ–è€…æ˜¾ç¤ºè®¾ç½®ä¸º trueã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œ

      1. é…ç½®ç±»æœ¬èº«ä¼šè¢« CGLIB è¿›è¡Œå¢å¼ºï¼Œæ³¨å†Œåˆ° IoC å®¹å™¨ä¸­çš„ Bean æ˜¯å…¶ä»£ç†å¯¹è±¡ï¼å¦‚ä¸Šè¿°æµ‹è¯•ç»“æœä¸­çš„ `fun.xiaorang.springboot.annotation.config.MainConfig$$EnhancerBySpringCGLIB$$4a661257@47a7c93e`ï¼›

      2. ä¸ç®¡æ˜¯é…ç½®ç±»å¤–éƒ¨è¿˜æ˜¯å†…éƒ¨å¤šæ¬¡è°ƒç”¨è¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼Œè¿”å›çš„éƒ½æ˜¯ IoC å®¹å™¨ä¸­çš„å•ä¾‹å¯¹è±¡ï¼Œä¿è¯è·å–åˆ°çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›å¦‚ä¸Šè¿°æµ‹è¯•ç»“æœä¸­ï¼ŒPerson å¯¹è±¡ä¸­çš„ pet å±æ€§ä¸ä» IoC å®¹å™¨ä¸­è·å–çš„ pet å¯¹è±¡ç›¸ç­‰ï¼Œè¯´æ˜è°ƒç”¨é…ç½®ç±»ä¸­è¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡æ˜¯ä» IoC å®¹å™¨è·å–çš„ï¼Œä¸ IoC å®¹å™¨ä¸­çš„å•å®ä¾‹ Bean æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚<span style="font-size:12px;">èµ°çš„æ˜¯é…ç½®ç±»ä»£ç†å¯¹è±¡çš„ä»£ç†é€»è¾‘</span>

      3. è¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ä¸èƒ½è¢« private æˆ–è€… final ä¿®é¥°ç¬¦è¿›è¡Œä¿®é¥°ï¼ˆå› ä¸ºç”± CGLIB åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ä¼šç»§æ‰¿è‡ªè¯¥ç±»ï¼Œè¢« private æˆ– final ä¿®é¥°çš„æ–¹æ³•æ— æ³•è¿›è¡Œé‡å†™ï¼‰ï¼Œå¦åˆ™å¯åŠ¨ä¼šæŠ¥é”™ï¼ˆå…¶å®åœ¨ç¼–è¯‘é˜¶æ®µ IDEA å°±å·²ç»ç»™å‡ºæç¤ºï¼Œä¸å…è®¸è¿™æ ·ä½¿ç”¨ï¼‰ï¼

         ![710263d6-42cc-44de-b15b-2a0a891daedf](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252246591.png)

      4. LITE æ¨¡å¼ï¼šç”±æºç å¯çŸ¥ï¼Œå­˜åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µï¼Œæ˜¯æŒ‡é…ç½®ç±» â¤µï¸

         1. ä¸Šæ ‡æ³¨çš„ @Configuration æ³¨è§£ä¸­çš„ proxyBeanMethods å±æ€§æ˜¾ç¤ºè®¾ç½®ä¸º falseï¼›
         2. è¢« @Component æˆ– @ComponentScan æˆ– @Import æˆ– @ImportResource å››ä¸ªæ³¨è§£æ‰€æ ‡æ³¨ï¼›
         3. ä¸­å­˜åœ¨è¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼›

         åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œ

         1. é…ç½®ç±»æœ¬èº«ä¸ä¼šè¢« CGLIB è¿›è¡Œå¢å¼ºï¼Œæ³¨å†Œåˆ° IoC å®¹å™¨ä¸­çš„ Bean æ˜¯å…¶æœ¬èº«çš„å®ä¾‹å¯¹è±¡ï¼›

         2. ä¸ç®¡æ˜¯é…ç½®ç±»å¤–éƒ¨è¿˜æ˜¯å†…éƒ¨å¤šæ¬¡è°ƒç”¨è¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼Œæ¯æ¬¡è·å–åˆ°çš„éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶é IoC å®¹å™¨ä¸­çš„å•å®ä¾‹ Beanï¼›<br />![image.png](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252247049.png)

         3. è¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•è™½ç„¶å¯ä»¥è¢« private æˆ–è€… final ä¿®é¥°ç¬¦è¿›è¡Œä¿®é¥°ï¼Œç¨‹åºè¿è¡Œæ—¶ä¸ä¼šæŠ¥é”™ï¼ä½†æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒIDEA å¹¶ä¸æ¨èè¿™æ ·ä½¿ç”¨ï¼<br />![image.png](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252248026.png)

         4. æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![image.png](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252249912.png)<br />ç”±ä¸Šè¿°ç»“æœå¯çŸ¥ï¼Œåœ¨ LITE æ¨¡å¼ä¸‹ï¼Œ

            1. ä» IoC å®¹å™¨ä¸­è·å–åˆ°çš„ Bean æ˜¯é…ç½®ç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯ä»£ç†å¯¹è±¡ï¼›

            2. Person å¯¹è±¡ä¸­çš„ pet å±æ€§ä¸ä» IoC å®¹å™¨ä¸­è·å–çš„ pet å¯¹è±¡å¹¶ä¸ç›¸ç­‰ï¼Œè¯´æ˜ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼å¦‚æœæƒ³å°† IoC å®¹å™¨ä¸­çš„ pet å®ä¾‹å¯¹è±¡æ³¨å…¥åˆ° Person å¯¹è±¡ä¸­çš„ pet å±æ€§ï¼Œåˆ™ä¸è¦é€šè¿‡è°ƒç”¨æ–¹æ³•çš„æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡æ–¹æ³•å‚æ•°çš„æ–¹å¼ï¼Œå‰é¢å·²ç»æåˆ°è¿‡ï¼Œè¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ä¸­çš„å‚æ•°ä¼šç”± IoC å®¹å™¨è‡ªåŠ¨æ³¨å…¥ï¼è¿™æ ·è·å–åˆ°çš„å°±ä¼šæ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

               ```java
               @Bean
               public Person person(Pet pet) {
                   return new Person("xiaorang", 18, pet);
               }
               ```

               å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼šPerson å¯¹è±¡ä¸­çš„ pet å±æ€§ä¸ä» IoC å®¹å™¨ä¸­è·å–çš„ pet å¯¹è±¡ç›¸ç­‰ï¼Œè¯´æ˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼<br />![image.png](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252250948.png)

      5. å¼€å‘ä¸­é—´ä»¶ã€é€šç”¨ç»„ä»¶ï¼Œå»ºè®®ä½¿ç”¨ LITE æ¨¡å¼ï¼Œæé«˜è¿è¡Œæ€§èƒ½ï¼Œé™ä½å¯åŠ¨æ—¶é—´ï¼ˆå› ä¸ºä¸éœ€è¦å¯¹é…ç½®ç±»ä½¿ç”¨ CGLIB è¿›è¡ŒåŠ¨æ€ä»£ç†ï¼‰ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥çœ‹åˆ° SpringBoot å¤§é‡ xxxAutoConfiguration é…ç½®ç±»ä¸­ @Configuration æ³¨è§£çš„ proxyBeanMethods = falseï¼Œå³ä½¿ç”¨ LITE æ¨¡å¼ã€‚

### @ComponentScan + @Component

åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œä½¿ç”¨çš„æ›´å¤šçš„æ˜¯åŒ…æ‰«æå¯¹é¡¹ç›®ä¸­çš„ç±»è¿›è¡Œæ‰«æï¼Œé»˜è®¤ä¼šæ‰«ææŒ‡å®šåŒ…è·¯å¾„åŠå…¶å­åŒ…ä¸‹æ‰€æœ‰æ ‡æ³¨ @Repositoryã€@Serviceã€@Controller å’Œ @Component æ³¨è§£çš„ç±»å¹¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ã€‚<br />å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ SpringBoot é¡¹ç›®çš„å¯åŠ¨ç±»ä¸Šæ ‡æ³¨äº†ä¸€ä¸ª @SpringbootApplication å¤åˆæ³¨è§£ï¼Œè¯¥æ³¨è§£ç”± @SpringBootConfigurationã€@EnableAutoConfiguration å’Œ @ComponentScan ä¸‰ä¸ªæ³¨è§£ç»„æˆï¼Œç›®å‰å…³æ³¨çš„ç‚¹æ˜¯ @ComponentScan æ³¨è§£ï¼Œè‡³äºå‰ä¸¤ä¸ªæ³¨è§£åç»­ä¼šåœ¨ [SpringBoot-è‡ªåŠ¨é…ç½®åŸç†å‰–æ](https://www.yuque.com/xihuanxiaorang/java/lq4s5y5kgewbm5wc?view=doc_embed) ä¸­å¯¹å…¶è¿›è¡Œè¯¦ç»†åˆ†æï¼

```java
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(
    excludeFilters = {@Filter(
    type = FilterType.CUSTOM,
    classes = {TypeExcludeFilter.class}
), @Filter(
    type = FilterType.CUSTOM,
    classes = {AutoConfigurationExcludeFilter.class}
)}
)
public @interface SpringBootApplication {
    ...
    @AliasFor(
        annotation = ComponentScan.class,
        attribute = "basePackages"
    )
    String[] scanBasePackages() default {};
    ...
}
```

ç”± @SpringbootApplication æ³¨è§£çš„å®šä¹‰å¯çŸ¥ï¼Œå…¶ basePackages å±æ€§å¯¹åº”çš„å…¶å®æ˜¯ @ComponentScan ä¸­çš„ basePackages å±æ€§ï¼Œå½“ basePackages å±æ€§ç¼ºçœæ—¶ï¼Œåˆ™é»˜è®¤ä¼šæ‰«æå½“å‰å¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹æ‰€æœ‰æ ‡æ³¨ @Repositoryã€@Serviceã€@Controller å’Œ @Component æ³¨è§£çš„ç±»å¹¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ã€‚è‡³äº @ComponentScan æ³¨è§£å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Documented
@Repeatable(ComponentScans.class)
public @interface ComponentScan {
    /**
		ç”¨äºæŒ‡å®šè¦æ‰«æçš„åŒ…ã€‚
	 */
    @AliasFor("basePackages")
    String[] value() default {};

    /**
  	å®ƒå’Œvalueä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚
	 */
    @AliasFor("value")
    String[] basePackages() default {};

    /**
	  	æŒ‡å®šå…·ä½“è¦æ‰«æçš„ç±»çš„å­—èŠ‚ç ã€‚
	 */
    Class<?>[] basePackageClasses() default {};

    /**
	  	æŒ‡å®šæ‰«æbeanå¯¹è±¡å­˜å…¥å®¹å™¨æ—¶çš„å‘½åè§„åˆ™ã€‚
	 */
    Class<? extends BeanNameGenerator> nameGenerator() default BeanNameGenerator.class;

    Class<? extends ScopeMetadataResolver> scopeResolver() default AnnotationScopeMetadataResolver.class;

    ScopedProxyMode scopedProxy() default ScopedProxyMode.DEFAULT;

    String resourcePattern() default ClassPathScanningCandidateComponentProvider.DEFAULT_RESOURCE_PATTERN;

    /**
	  	æ˜¯å¦ä½¿ç”¨é»˜è®¤çš„è¿‡æ»¤è§„åˆ™ï¼Œæ˜¯çš„è¯åˆ™ä¼šæ‰«ææŒ‡å®šåŒ…ä»¥åŠå­åŒ…ä¸‹æ‰€æœ‰æ ‡æ³¨@Componentã€@Repositoryã€@Serviceã€@Controller æ³¨è§£çš„ç±»å¹¶å°†å…¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼Œé»˜è®¤ä¸º true
	 */
    boolean useDefaultFilters() default true;

    /**
	  	è‡ªå®šä¹‰ç»„ä»¶æ‰«æçš„è¿‡æ»¤è§„åˆ™ï¼Œç”¨ä»¥æ‰«æç»„ä»¶ã€‚
			FilterTypeæœ‰5ç§ç±»å‹ï¼š
	            ANNOTATION, æ³¨è§£ç±»å‹ é»˜è®¤
	            ASSIGNABLE_TYPE,æŒ‡å®šå›ºå®šç±»
	            ASPECTJï¼Œ ASPECTJç±»å‹
	            REGEX,æ­£åˆ™è¡¨è¾¾å¼
	            CUSTOM,è‡ªå®šä¹‰ç±»å‹
	 */
    Filter[] includeFilters() default {};

    /**
	  	è‡ªå®šä¹‰ç»„ä»¶æ‰«æçš„æ’é™¤è§„åˆ™ã€‚
	 */
    Filter[] excludeFilters() default {};

    /**
	  	ç»„ä»¶æ‰«ææ—¶æ˜¯å¦é‡‡ç”¨æ‡’åŠ è½½ ï¼Œé»˜è®¤ä¸å¼€å¯ã€‚
	 */
    boolean lazyInit() default false;

    @Retention(RetentionPolicy.RUNTIME)
    @Target({})
    @interface Filter {
        FilterType type() default FilterType.ANNOTATION;

        @AliasFor("classes")
        Class<?>[] value() default {};

        @AliasFor("value")
        Class<?>[] classes() default {};

        String[] pattern() default {};
    }
}
```

ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œå°† @SpringbootApplication å¤åˆæ³¨è§£æ‹†åˆ†æˆ @SpringBootConfigurationã€@EnableAutoConfiguration å’Œ @ComponentScan ä¸‰ä¸ªæ³¨è§£æ ‡æ³¨åœ¨å¯åŠ¨ç±»ä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(
        excludeFilters = {@ComponentScan.Filter(
                type = FilterType.CUSTOM,
                classes = {TypeExcludeFilter.class}
        ), @ComponentScan.Filter(
                type = FilterType.CUSTOM,
                classes = {AutoConfigurationExcludeFilter.class}
        )}
)
public class SpringBootAnnotationStudy {
    public static void main(String[] args) {
        SpringApplication.run(SpringBootAnnotationStudy.class, args);
    }
}
```

å‰æœŸå‡†å¤‡ï¼Œå¢åŠ ä¸‰ä¸ªåˆ†åˆ«æ ‡æ³¨ @Controllerã€@Serviceã€@Repository æ³¨è§£çš„ç»„ä»¶ï¼š

```java
@Controller
public class BookController {

}
```

```java
@Service
public class BookService {

}
```

```java
@Repository
public class BookRepository {

}
```

ç°åœ¨ç€é‡æ¥åˆ†æä¸‹ @ComponentScan æ³¨è§£ä¸­çš„ includeFilters å’Œ excludeFilters ä¸¤ä¸ªå±æ€§ã€‚

- includeFilters å±æ€§ç”¨äºæŒ‡å®šè¿›è¡ŒåŒ…æ‰«ææ—¶è¯¥æŒ‰ç…§ä»€ä¹ˆè¿‡æ»¤è§„åˆ™å»æ³¨å†Œï¼ˆä¿ç•™ï¼‰ç»„ä»¶ï¼›

  ä¸¾ä¸ªæ —å­ï¼Œåœ¨å¯åŠ¨ç±»ä¸Šå¢åŠ å¦ä¸€ä¸ª @ComponentScan æ³¨è§£ï¼ˆè¯¥æ³¨è§£ç”± @Repeatable æ³¨è§£æ ‡æ³¨ï¼ŒJDK1.8 å‡ºç°ï¼Œé‡å¤æ³¨è§£ï¼Œè¢«å…¶æ ‡æ³¨çš„æ³¨è§£è¡¨ç¤ºå¯ä»¥åœ¨ç±»ä¸Šæ ‡æ³¨å¤šæ¬¡ï¼‰ï¼Œè®©å…¶åªæ‰«æè¢« @Controller æ³¨è§£æ ‡æ³¨çš„ç±»å’Œ BookService ç±»ï¼Œç†è®ºä¸Šï¼Œè¿™æ ·åšçš„è¯ï¼ŒBookRepository ç±»å°±ä¸ä¼šè¢«æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ã€‚

  ```java
  @SpringBootConfiguration
  @EnableAutoConfiguration
  @ComponentScan(
          excludeFilters = {@ComponentScan.Filter(
                  type = FilterType.CUSTOM,
                  classes = {TypeExcludeFilter.class}
          ), @ComponentScan.Filter(
                  type = FilterType.CUSTOM,
                  classes = {AutoConfigurationExcludeFilter.class}
          )}
  )
  @ComponentScan(value = "fun.xiaorang.springboot.annotation", includeFilters = {
          @ComponentScan.Filter(type = ANNOTATION, classes = {Controller.class}),
          @ComponentScan.Filter(type = ASSIGNABLE_TYPE, classes = {BookService.class})
  })
  public class SpringBootAnnotationStudy {
      public static void main(String[] args) {
          SpringApplication.run(SpringBootAnnotationStudy.class, args);
      }
  }
  ```

  å¢åŠ æµ‹è¯•æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

  ```java
  @Test
  public void test_01(ApplicationContext applicationContext) {
      BookController bookController = applicationContext.getBean(BookController.class);
      System.out.println(bookController);
      BookService bookService = applicationContext.getBean(BookService.class);
      System.out.println(bookService);
      BookRepository bookRepository = applicationContext.getBean(BookRepository.class);
      System.out.println(bookRepository);
  }
  ```

  æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br /><img src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252252039.png" alt="69384956-0bd8-4228-bf74-625e9577782c" style="zoom:67%;" /><br />è¿™ä¸å¯¹å•Šï¼å’ŒçŒœæƒ³çš„ä¸ä¸€è‡´ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿå…¶å®ï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹è¿˜æ²¡æœ‰æåˆ°ï¼Œç”±ä¸Šé¢çš„å®šä¹‰å¯çŸ¥ï¼Œåœ¨ @ComponentScan æ³¨è§£ä¸­æœ‰ä¸€ä¸ª useDefaultFilters å±æ€§ï¼Œé»˜è®¤ä¸º trueï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„è¿‡æ»¤è§„åˆ™ï¼ˆæ‰«ææŒ‡å®šåŒ…åŠå…¶å­åŒ…ä¸‹æ‰€æœ‰æ ‡æ³¨@Componentã€@Repositoryã€@Serviceã€@Controller æ³¨è§£çš„ç±»å¹¶å°†å…¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼‰ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒBookRepository ç±»å°±è¢«æ‰«ææ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼Œè¦æƒ³æ’é™¤å¹²æ‰°ï¼Œå°±éœ€è¦å°†å¯åŠ¨ç±»ä¸Šæ ‡æ³¨çš„ä¸¤ä¸ª @ComponentScan æ³¨è§£ä¸­çš„ useDefaultFilters å±æ€§æ˜¾ç¤ºè®¾ç½®ä¸º falseï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

  ```java
  @SpringBootConfiguration
  @EnableAutoConfiguration
  @ComponentScan(
          excludeFilters = {@ComponentScan.Filter(
                  type = FilterType.CUSTOM,
                  classes = {TypeExcludeFilter.class}
          ), @ComponentScan.Filter(
                  type = FilterType.CUSTOM,
                  classes = {AutoConfigurationExcludeFilter.class}
          )}, useDefaultFilters = false
  )
  @ComponentScan(value = "fun.xiaorang.springboot.annotation", includeFilters = {
          @ComponentScan.Filter(type = ANNOTATION, classes = {Controller.class}),
          @ComponentScan.Filter(type = ASSIGNABLE_TYPE, classes = {BookService.class})
  }, useDefaultFilters = false)
  public class SpringBootAnnotationStudy {
      public static void main(String[] args) {
          SpringApplication.run(SpringBootAnnotationStudy.class, args);
      }
  }
  ```

  å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![77446dff-9754-46a6-be5a-ea1ef00820a2](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252252090.png)<br />è¾¾åˆ°é¢„æœŸæ•ˆæœï¼ŒIoC å®¹å™¨ä¸­åªå­˜åœ¨ BookController å’Œ BookService ç»„ä»¶ï¼ŒBookRepository ç»„ä»¶å¹¶æ²¡æœ‰è¢«æ‰«ææ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼Œæ‰€ä»¥ä» IoC å®¹å™¨ä¸­è·å–çš„æ—¶å€™æŠ›å‡ºå¦‚ä¸Šå¼‚å¸¸ï¼

- excludeFilters å±æ€§ç”¨äºæŒ‡å®šè¿›è¡ŒåŒ…æ‰«ææ—¶è¯¥æŒ‰ç…§ä»€ä¹ˆè¿‡æ»¤è§„åˆ™å»æ’é™¤ç»„ä»¶ï¼›

  ä¸¾ä¸ªæ —å­ï¼Œåœ¨å¢åŠ çš„ @ComponentScan æ³¨è§£ä¸­é…ç½® excludeFilters å±æ€§ï¼Œè®©å…¶ä¸æ‰«æè¢« @Service æ³¨è§£æ ‡æ³¨çš„ç±»ï¼Œç†è®ºä¸Šï¼Œè¿™æ ·åšçš„è¯ï¼ŒIoC å®¹å™¨ä¸­åªå‰©ä¸‹ BookController ç»„ä»¶ï¼ŒBookService ç»„ä»¶å°±è¢«æ’é™¤æ‰äº†ã€‚

  ```java
  @SpringBootConfiguration
  @EnableAutoConfiguration
  @ComponentScan(
          excludeFilters = {@ComponentScan.Filter(
                  type = FilterType.CUSTOM,
                  classes = {TypeExcludeFilter.class}
          ), @ComponentScan.Filter(
                  type = FilterType.CUSTOM,
                  classes = {AutoConfigurationExcludeFilter.class}
          )}, useDefaultFilters = false
  )
  @ComponentScan(value = "fun.xiaorang.springboot.annotation", includeFilters = {
          @ComponentScan.Filter(type = ANNOTATION, classes = {Controller.class}),
          @ComponentScan.Filter(type = ASSIGNABLE_TYPE, classes = {BookService.class})
  }, excludeFilters = {
          @ComponentScan.Filter(type = ANNOTATION, classes = Service.class)
  }, useDefaultFilters = false)
  public class SpringBootAnnotationStudy {
      public static void main(String[] args) {
          SpringApplication.run(SpringBootAnnotationStudy.class, args);
      }
  }
  ```

  å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![18b4164d-c7b3-4a3d-99ad-9f0e6777c71b](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252253754.png)<br />è¾¾åˆ°é¢„æœŸæ•ˆæœï¼ŒIoC å®¹å™¨ä¸­åªå­˜åœ¨ BookController ç»„ä»¶ï¼ŒBookService ç»„ä»¶è¢«æ’é™¤åœ¨å¤–ï¼Œæ‰€ä»¥ä» IoC å®¹å™¨ä¸­è·å–çš„æ—¶å€™æŠ›å‡ºå¦‚ä¸Šå¼‚å¸¸ï¼<br />

ä» @ComponentScan æ³¨è§£ä¸­çš„ @Filter æ³¨è§£å®šä¹‰å¯çŸ¥ï¼Œç»„ä»¶æ‰«æçš„è¿‡æ»¤è§„åˆ™æœ‰ 5 ç§ï¼Œä½äº FilterType æšä¸¾ç±»ä¸­

- ANNOTATIONï¼Œæ³¨è§£ç±»å‹ é»˜è®¤
- ASSIGNABLE_TYPEï¼ŒæŒ‡å®šå›ºå®šç±»
- ASPECTJï¼ŒASPECTJ è¡¨è¾¾å¼
- REGEXï¼Œæ­£åˆ™è¡¨è¾¾å¼
- CUSTOMï¼Œè‡ªå®šä¹‰ç±»å‹

å‰é¢å››ç§è¿‡æ»¤è§„åˆ™éƒ½å®ç°äº† <u>TypeFilter</u> æ¥å£ï¼Œå¹¶ä¸”éƒ½æœ‰é»˜è®¤çš„å®ç°ç±»ã€‚å¦‚æœæƒ³è¦è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™çš„è¯ï¼Œä¾è‘«èŠ¦ç”»ç“¢ï¼ŒåŒæ ·éœ€è¦å®ç° TypeFilter æ¥å£ã€‚<br />**ğŸ“ éœ€æ±‚**ï¼šæ‰«ææ‰€æœ‰æ ‡æ³¨è‡ªå®šä¹‰æ³¨è§£ @MyComponent çš„ç±»å¹¶å°†å…¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ã€‚å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

1. è‡ªå®šä¹‰æ³¨è§£

   ```java
   @Target(ElementType.TYPE)
   @Retention(RetentionPolicy.RUNTIME)
   @Documented
   public @interface MyComponent {
   }
   ```

2. è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™

   ```java
   public class MyTypeFilter implements TypeFilter {
       @Override
       public boolean match(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory) {
           AnnotationMetadata metadata = metadataReader.getAnnotationMetadata();
           return metadata.hasAnnotation(MyComponent.class.getName());
       }
   }
   ```

3. å¢åŠ è¢«è‡ªå®šä¹‰æ³¨è§£æ ‡æ³¨çš„ç±»

   ```java
   @MyComponent
   public class Man {
   
   }
   ```

4. å¯åŠ¨ç±»ä¸Šæ–°æ ‡æ³¨çš„ @ComponentScan æ³¨è§£ä¸­çš„ includeFilters å±æ€§å¢åŠ é…ç½®

   ```java
   @SpringBootConfiguration
   @EnableAutoConfiguration
   @ComponentScan(
           excludeFilters = {@ComponentScan.Filter(
                   type = FilterType.CUSTOM,
                   classes = {TypeExcludeFilter.class}
           ), @ComponentScan.Filter(
                   type = FilterType.CUSTOM,
                   classes = {AutoConfigurationExcludeFilter.class}
           )}, useDefaultFilters = false
   )
   @ComponentScan(value = "fun.xiaorang.springboot.annotation", includeFilters = {
           @ComponentScan.Filter(type = ANNOTATION, classes = {Controller.class}),
           @ComponentScan.Filter(type = ASSIGNABLE_TYPE, classes = {BookService.class}),
           @ComponentScan.Filter(type = CUSTOM, classes = {MyTypeFilter.class})
   }, excludeFilters = {
           @ComponentScan.Filter(type = ANNOTATION, classes = Service.class)
   }, useDefaultFilters = false)
   public class SpringBootAnnotationStudy {
       public static void main(String[] args) {
           SpringApplication.run(SpringBootAnnotationStudy.class, args);
       }
   }
   ```

5. å¢åŠ æµ‹è¯•æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```java
   @Test
   public void test_02(ApplicationContext applicationContext) {
       Man man = applicationContext.getBean(Man.class);
       System.out.println(man);
   }
   ```

   æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br /><img src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252255733.png" alt="491e9e84-e389-46d0-99d8-16997c208d97" style="zoom:67%;" />

### @Import

å‰é¢å·²ç»ä»‹ç»è¿‡å¯ä»¥ä½¿ç”¨ @ComponentScan + @Component è¿™ç§æ–¹å¼å‘ IoC å®¹å™¨ä¸­æ³¨å†Œç»„ä»¶ï¼Œä¸è¿‡è¿™è¿™ç§æ–¹å¼æœ‰å±€é™æ€§ï¼Œåªèƒ½æ‰«ææœ¬é¡¹ç›®ä¸­çš„ç±»å¹¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼Œè‡³äºç¬¬ä¸‰æ–¹ jar åŒ…ä¸­çš„ç±»è¯¥å¦‚ä½•è¿›è¡Œæ³¨å†Œåˆ° IoC å®¹å™¨ä¸­å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ @Configuration + @Bean è§£å†³ï¼Œä¸è¿‡ç°åœ¨ä»‹ç»å¦ä¸€ç§æ–¹æ¡ˆï¼šä½¿ç”¨ @Import æ³¨è§£å¿«é€Ÿå‘ IoC å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶ã€‚å…¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Import {

	/**
	 * {@link Configuration @Configuration}, {@link ImportSelector},
	 * {@link ImportBeanDefinitionRegistrar}, or regular component classes to import.
	 */
	Class<?>[] value();

}
```

ç”± @Import æ³¨è§£çš„å®šä¹‰å¯çŸ¥ï¼Œ

1. @Import æ³¨è§£åªèƒ½ä½œç”¨åœ¨ç±»ä¸Šï¼Œé€šå¸¸é…åˆé…ç½®ç±»ï¼ˆè¢« @Configuration æ³¨è§£æ ‡æ³¨çš„ç±»ï¼‰ä¸€èµ·ä½¿ç”¨ï¼›

2. å…¶ value å±æ€§å¯ä»¥ä½¿ç”¨è¢« @Configuration æ ‡æ³¨çš„é…ç½®ç±»ï¼Œå®ç° ImportSelector æˆ– ImportBeanDefinitionRegistrar æ¥å£çš„ç±»ï¼Œä¸€ä¸ªç®€å•çš„ç±»ï¼›

   1. ï¼ˆå‘ IoC å®¹å™¨ä¸­å¯¼å…¥ï¼‰ä¸€ä¸ªç®€å•çš„ç±»

      1. ç®€å•çš„ç±»

         ```java
         public class Color {
         
         }
         ```

      2. é…ç½®ç±» MainConfig ä¸Šæ ‡æ³¨ @Import æ³¨è§£ï¼Œç”¨äºå‘ IoC å®¹å™¨ä¸­å¿«é€Ÿå¯¼å…¥ Color ç»„ä»¶

         ```java
         @Configuration(proxyBeanMethods = false)
         @Import({Color.class})
         public class MainConfig {
             @Bean
             public Person person(Pet pet) {
                 return new Person("xiaorang", 18, pet);
             }
         
             @Bean
             public Pet pet() {
                 return new Pet("xiaobai", 2);
             }
         }
         ```

      3. å¯åŠ¨ç±»ä¸Šæ ‡æ³¨æ–°çš„ @ComponentScan æ³¨è§£ï¼Œç”¨äºæ‰«æ MainConfig é…ç½®ç±»

         ```java
         @SpringBootConfiguration
         @EnableAutoConfiguration
         @ComponentScan(useDefaultFilters = false, includeFilters = {
                 @ComponentScan.Filter(type = ASSIGNABLE_TYPE, classes = {MainConfig.class})
         })
         @ComponentScan(
                 excludeFilters = {@ComponentScan.Filter(
                         type = FilterType.CUSTOM,
                         classes = {TypeExcludeFilter.class}
                 ), @ComponentScan.Filter(
                         type = FilterType.CUSTOM,
                         classes = {AutoConfigurationExcludeFilter.class}
                 )}, useDefaultFilters = false
         )
         @ComponentScan(value = "fun.xiaorang.springboot.annotation", includeFilters = {
                 @ComponentScan.Filter(type = ANNOTATION, classes = {Controller.class}),
                 @ComponentScan.Filter(type = ASSIGNABLE_TYPE, classes = {BookService.class}),
                 @ComponentScan.Filter(type = CUSTOM, classes = {MyTypeFilter.class})
         }, excludeFilters = {
                 @ComponentScan.Filter(type = ANNOTATION, classes = Service.class)
         }, useDefaultFilters = false)
         public class SpringBootAnnotationStudy {
             public static void main(String[] args) {
                 SpringApplication.run(SpringBootAnnotationStudy.class, args);
             }
         }
         ```

      4. å¢åŠ æµ‹è¯•æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

         ```java
         @Test
         public void test_03(ApplicationContext applicationContext) {
             Color color = applicationContext.getBean(Color.class);
             System.out.println(color);
         }
         ```

         æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼šå‘ç°å¯ä»¥ä» IoC å®¹å™¨ä¸­è·å–åˆ° Color ç»„ä»¶ã€‚<br /><img src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252257567.png" alt="5b2031fb-e950-4351-9e8c-e7ee77191bac" style="zoom:67%;" />

      5. ï¼ˆå‘ IoC å®¹å™¨ä¸­å¯¼å…¥ï¼‰å®ç° ImportSelector æ¥å£çš„ç±»ï¼Œå…³äº ImportSelector æ¥å£çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š

         ```java
         public interface ImportSelector {
         
         	/**
         	 * Select and return the names of which class(es) should be imported based on
         	 * the {@link AnnotationMetadata} of the importing @{@link Configuration} class.
         	 * @return the class names, or an empty array if none
         	 */
         	String[] selectImports(AnnotationMetadata importingClassMetadata);
         
         	/**
         	 * Return a predicate for excluding classes from the import candidates, to be
         	 * transitively applied to all classes found through this selector's imports.
         	 * <p>If this predicate returns {@code true} for a given fully-qualified
         	 * class name, said class will not be considered as an imported configuration
         	 * class, bypassing class file loading as well as metadata introspection.
         	 * @return the filter predicate for fully-qualified candidate class names
         	 * of transitively imported configuration classes, or {@code null} if none
         	 * @since 5.2.4
         	 */
         	@Nullable
         	default Predicate<String> getExclusionFilter() {
         		return null;
         	}
         
         }
         ```

         è¯¥æ¥å£ä¸»è¦é…åˆ @Import æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œä½œç”¨æ˜¯æ”¶é›†éœ€è¦å¯¼å…¥çš„ç±»ï¼Œå…¶ä¸­çš„ selectImports() æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯éœ€è¦å‘ IoC å®¹å™¨ä¸­å¯¼å…¥çš„**ç±»çš„å®Œå…¨é™å®šå**ã€‚å¦‚æœè¯¥æ¥å£çš„å®ç°ç±»åŒæ—¶å®ç° EnvironmentAwareã€BeanFactoryAwareã€BeanClassLoaderAware å’Œ ResourceLoaderAware ç­‰æ¥å£ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨å…¶ selectImports() æ–¹æ³•ä¹‹å‰ä¼šå…ˆè°ƒç”¨ä¸Šè¿°æ¥å£ä¸­å¯¹åº”çš„æ–¹æ³•ï¼Œå¦‚æœéœ€è¦åœ¨æ‰€æœ‰çš„ @Configuration é…ç½®ç±»å¤„ç†å®Œå†è¿›è¡Œå¯¼å…¥ï¼Œé‚£ä¹ˆå¯ä»¥å®ç°å…¶å­ç±» DeferredImportSelector æ¥å£ã€‚ <br />åœ¨ selectImports() æ–¹æ³•ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ª AnnotationMetadata ç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°èƒ½å¤Ÿè·å–åˆ°ä¸è¯¥æ¥å£ä¸€èµ·é…åˆä½¿ç”¨çš„ @Import æ³¨è§£ä¸­çš„å±æ€§ä¿¡æ¯ã€‚<br />**ğŸ“ éœ€æ±‚**ï¼šä½¿ç”¨ @Import æ³¨è§£é…åˆ ImportSelector æ¥å£çš„æ–¹å¼å‘ IoC å®¹å™¨ä¸­å¯¼å…¥ Yellow å’Œ Blue ä¸¤ä¸ªç»„ä»¶ã€‚å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

         1. Yellow å’Œ Blue ä¸¤ä¸ªç±»

            ```java
            public class Yellow {
            
            }
            ```

            ```java
            public class Blue {
            
            }
            ```

         2. è‡ªå®šä¹‰çš„ ImportSelector æ¥å£å®ç°ç±»

            ```java
            public class MyImportSelector implements ImportSelector {
                @Override
                public String[] selectImports(AnnotationMetadata importingClassMetadata) {
                    return new String[]{"fun.xiaorang.springboot.annotation.pojo.Yellow", "fun.xiaorang.springboot.annotation.pojo.Blue"};
                }
            }
            ```

         3. é…ç½®ç±» MainConfig ä¸Šæ ‡æ³¨çš„ @Import æ³¨è§£ä¸­å¢åŠ è‡ªå®šä¹‰çš„ ImportSelector æ¥å£å®ç°ç±»

            ```java
            @Configuration(proxyBeanMethods = false)
            @Import({Color.class, MyImportSelector.class})
            public class MainConfig {
                @Bean
                public Person person(Pet pet) {
                    return new Person("xiaorang", 18, pet);
                }
            
                @Bean
                public Pet pet() {
                    return new Pet("xiaobai", 2);
                }
            }
            ```

         4. å¢åŠ æµ‹è¯•ä»£ç ç‰‡æ®µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

            ```java
            @Test
            public void test_03(ApplicationContext applicationContext) {
                Color color = applicationContext.getBean(Color.class);
                System.out.println(color);
                Yellow yellow = applicationContext.getBean(Yellow.class);
                System.out.println(yellow);
                Blue blue = applicationContext.getBean(Blue.class);
                System.out.println(blue);
            }
            ```

            æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼šå‘ç°å¯ä»¥ä» IoC å®¹å™¨ä¸­è·å–åˆ° Yellow å’Œ Blue ç»„ä»¶ã€‚<br /><img src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252259192.png" alt="649448a8-6af9-4b18-b476-ce23d2ce35db" style="zoom:67%;" />

   2. ï¼ˆå‘ IoC å®¹å™¨ä¸­å¯¼å…¥ï¼‰å®ç° ImportBeanDefinitionRegistrar æ¥å£çš„ç±»ï¼Œå…³äº ImportBeanDefinitionRegistrar æ¥å£çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š

      ```java
      public interface ImportBeanDefinitionRegistrar {
      
      	/**
      	 * Register bean definitions as necessary based on the given annotation metadata of
      	 * the importing {@code @Configuration} class.
      	 * <p>Note that {@link BeanDefinitionRegistryPostProcessor} types may <em>not</em> be
      	 * registered here, due to lifecycle constraints related to {@code @Configuration}
      	 * class processing.
      	 * <p>The default implementation delegates to
      	 * {@link #registerBeanDefinitions(AnnotationMetadata, BeanDefinitionRegistry)}.
      	 * @param importingClassMetadata annotation metadata of the importing class
      	 * @param registry current bean definition registry
      	 * @param importBeanNameGenerator the bean name generator strategy for imported beans:
      	 * {@link ConfigurationClassPostProcessor#IMPORT_BEAN_NAME_GENERATOR} by default, or a
      	 * user-provided one if {@link ConfigurationClassPostProcessor#setBeanNameGenerator}
      	 * has been set. In the latter case, the passed-in strategy will be the same used for
      	 * component scanning in the containing application context (otherwise, the default
      	 * component-scan naming strategy is {@link AnnotationBeanNameGenerator#INSTANCE}).
      	 * @since 5.2
      	 * @see ConfigurationClassPostProcessor#IMPORT_BEAN_NAME_GENERATOR
      	 * @see ConfigurationClassPostProcessor#setBeanNameGenerator
      	 */
      	default void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry,
      			BeanNameGenerator importBeanNameGenerator) {
      
      		registerBeanDefinitions(importingClassMetadata, registry);
      	}
      
      	/**
      	 * Register bean definitions as necessary based on the given annotation metadata of
      	 * the importing {@code @Configuration} class.
      	 * <p>Note that {@link BeanDefinitionRegistryPostProcessor} types may <em>not</em> be
      	 * registered here, due to lifecycle constraints related to {@code @Configuration}
      	 * class processing.
      	 * <p>The default implementation is empty.
      	 * @param importingClassMetadata annotation metadata of the importing class
      	 * @param registry current bean definition registry
      	 */
      	default void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
      	}
      
      }
      ```

      è¯¥æ¥å£ä¸»è¦é…åˆ @Import æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡æ¥å£ä¸­å®šä¹‰çš„ registerBeanDefinitions() æ–¹æ³•å‘ IoC å®¹å™¨ä¸­æ³¨å†Œç»„ä»¶çš„å®šä¹‰ä¿¡æ¯(BeanDefinition)ï¼ŒSpring åç»­ä¼šæ ¹æ®ç»„ä»¶çš„å®šä¹‰ä¿¡æ¯åˆ›å»ºå‡ºå¯¹åº”çš„ç»„ä»¶æ³¨å†Œåˆ° IoC å®¹å™¨ä¸­ï¼Œè¿™æ ·çœ‹ä¸Šå»ä½œç”¨å¥½åƒä¸ ImportSelector æ¥å£å·®ä¸å¤šã€‚<br />åœ¨ registerBeanDefinitions() æ–¹æ³•ä¸­ï¼ŒåŒæ ·å­˜åœ¨ä¸€ä¸ª AnnotationMetadata ç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°èƒ½å¤Ÿè·å–åˆ°ä¸è¯¥æ¥å£ä¸€èµ·é…åˆä½¿ç”¨çš„ @Import æ³¨è§£ä¸­çš„å±æ€§ä¿¡æ¯ï¼Œæœ€å…¸å‹çš„æ —å­å°±æ˜¯ç”¨äºå¼€å¯äº‹åŠ¡çš„ @EnableAspectJAutoProxy æ³¨è§£ã€‚<br />**ğŸ“ éœ€æ±‚**ï¼šä½¿ç”¨ @Import æ³¨è§£é…åˆ ImportBeanDefinitionRegistrar æ¥å£çš„æ–¹å¼å‘ IoC å®¹å™¨ä¸­å¯¼å…¥ Rainbow ç»„ä»¶ã€‚å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

      1. Rainbow ç±»

         ```java
         public class Rainbow {
         
         }
         ```

      2. è‡ªå®šä¹‰çš„ ImportBeanDefinitionRegistrar æ¥å£å®ç°ç±»

         ```java
         public class MyImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar {
             @Override
             public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {
                 BeanDefinition beanDefinition = new GenericBeanDefinition();
                 beanDefinition.setBeanClassName(Rainbow.class.getName());
                 registry.registerBeanDefinition("rainbow", beanDefinition);
             }
         }
         ```

      3. é…ç½®ç±» MainConfig ä¸Šæ ‡æ³¨çš„ @Import æ³¨è§£ä¸­å¢åŠ è‡ªå®šä¹‰çš„ ImportBeanDefinitionRegistrar æ¥å£å®ç°ç±»

         ```java
         @Configuration(proxyBeanMethods = false)
         @Import({Color.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class})
         public class MainConfig {
             @Bean
             public Person person(Pet pet) {
                 return new Person("xiaorang", 18, pet);
             }
         
             @Bean
             public Pet pet() {
                 return new Pet("xiaobai", 2);
             }
         }
         ```

      4. å¢åŠ æµ‹è¯•ä»£ç ç‰‡æ®µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

         ```java
         @Test
         public void test_03(ApplicationContext applicationContext) {
             Color color = applicationContext.getBean(Color.class);
             System.out.println(color);
             Yellow yellow = applicationContext.getBean(Yellow.class);
             System.out.println(yellow);
             Blue blue = applicationContext.getBean(Blue.class);
             System.out.println(blue);
             Rainbow rainbow = applicationContext.getBean(Rainbow.class);
             System.out.println(rainbow);
         }
         ```

         æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼šå‘ç°å¯ä»¥ä» IoC å®¹å™¨ä¸­è·å–åˆ° Rainbow ç»„ä»¶ã€‚<br /><img src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252302724.png" alt="d4715095-b0fb-4873-b153-de89faebaef6" style="zoom:67%;" />

## ç”Ÿå‘½å‘¨æœŸ

ä¸€ä¸ª Bean çš„ç”Ÿå‘½å‘¨æœŸä¸»è¦åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼šå®ä¾‹åŒ–ã€å±æ€§å¡«å……(ä¾èµ–æ³¨å…¥)ã€åˆå§‹åŒ–ã€é”€æ¯é˜¶æ®µã€‚è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒ [Spring-Bean çš„ç”Ÿå‘½å‘¨æœŸ](https://www.yuque.com/xihuanxiaorang/java/yn52zdeq6uaey5ar?view=doc_embed) æ–‡ç« ï¼<br />æ­¤å¤„ä¸»è¦æ¶‰åŠåˆ° @PostConstruct + @PreDestroy ä¸¤ä¸ªæ³¨è§£ï¼Œåˆ†åˆ«ä½œç”¨äº Bean çš„åˆå§‹åŒ–å’Œé”€æ¯é˜¶æ®µã€‚

- @PostConstruct æ³¨è§£ä¸»è¦ç”¨äºè‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•ä½œç”¨äº Bean çš„åˆå§‹åŒ–é˜¶æ®µï¼Œå­˜åœ¨ä»¥ä¸‹å‡ ç§ç­‰ä»·çš„è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•çš„æ–¹å¼ï¼š
  - å®ç° InitializingBean æ¥å£ï¼Œé‡å†™è¯¥æ¥å£å®šä¹‰çš„ afterPropertiesSet() æ–¹æ³•ï¼›
  - æŒ‡å®š @Bean æ³¨è§£ä¸­çš„ initMethod å±æ€§ï¼›ä¸ XML é…ç½®æ–‡ä»¶ä¸­ bean æ ‡ç­¾çš„ init-method å±æ€§ç±»ä¼¼
- @PreDestroy æ³¨è§£ä¸»è¦ç”¨äºè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ä½œç”¨ä¸ Bean çš„é”€æ¯é˜¶æ®µï¼Œå­˜åœ¨ä»¥ä¸‹å‡ ç§ç­‰ä»·çš„è‡ªå®šä¹‰é”€æ¯æ–¹æ³•çš„æ–¹å¼ï¼š
  - å®ç° DisposableBean æ¥å£ï¼Œé‡å†™è¯¥æ¥å£å®šä¹‰çš„ destroy() æ–¹æ³•ï¼›
  - æŒ‡å®š @Bean æ³¨è§£ä¸­çš„ destroyMethod å±æ€§ï¼›ä¸ XML é…ç½®æ–‡ä»¶ä¸­ bean æ ‡ç­¾çš„ destroy-method å±æ€§ç±»ä¼¼

**ğŸ“ éœ€æ±‚**ï¼šä½¿ç”¨ @Configuration + @Bean æ³¨è§£çš„æ–¹å¼å‘ IoC å®¹å™¨ä¸­æ³¨å†Œ Cat ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸Šæåˆ°çš„å‡ ç§æ–¹å¼é…ç½®è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³•ã€‚å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

1. Cat ç±»ï¼Œ

   1. åˆ›å»ºåˆ†åˆ«è¢« @PostConstruct å’Œ @PreDestroy æ³¨è§£æ ‡æ³¨çš„ postConstruct() å’Œ destroy() æ–¹æ³•ï¼›
   2. å®ç° InitializingBean å’Œ DisposableBean æ¥å£ï¼Œé‡å†™è¿™ä¸¤ä¸ªæ¥å£ä¸­å®šä¹‰çš„ afterPropertiesSet() å’Œ destroy() æ–¹æ³•ï¼›
   3. åˆ›å»º initMethod() å’Œ destroyMethod() æ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºé…ç½® @Bean æ³¨è§£ä¸­çš„ init-method å’Œ destroy-method å±æ€§ï¼›

   ```java
   @Slf4j
   public class Cat implements InitializingBean, DisposableBean {
       @PostConstruct
       public void postConstruct() {
           log.info("postConstruct()");
       }
   
       @Override
       public void afterPropertiesSet() {
           log.info("InitializingBean#afterPropertiesSet()");
       }
   
       public void initMethod() {
           log.info("initMethod()");
       }
   
       @PreDestroy
       public void preDestroy() {
           log.info("preDestroy()");
       }
   
       @Override
       public void destroy() {
           log.info("DisposableBean#destroy()");
       }
   
       public void destroyMethod() {
           log.info("destroyMethod()");
       }
   }
   ```

2. é…ç½®ç±» MainConfig ä¸­å¢åŠ è¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–°æ–¹æ³•ï¼ŒæŒ‡å®š @Bean æ³¨è§£ä¸­çš„ initMethod å’Œ destroyMethod å±æ€§

   ```java
   @Configuration(proxyBeanMethods = false)
   @Import({Color.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class})
   public class MainConfig {
       @Bean
       public Person person(Pet pet) {
           return new Person("xiaorang", 18, pet);
       }
   
       @Bean
       public Pet pet() {
           return new Pet("xiaobai", 2);
       }
   
       @Bean(initMethod = "initMethod", destroyMethod = "destroyMethod")
       public Cat cat() {
           return new Cat();
       }
   }
   ```

3. å¢åŠ æµ‹è¯•æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```java
   @Test
   public void test_04(ApplicationContext applicationContext) {
       Cat cat = applicationContext.getBean(Cat.class);
       System.out.println(cat);
   }
   ```

   æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![723bf20c-d51c-4acd-b915-3e243e7f9bb7](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252304468.png)

## å±æ€§èµ‹å€¼

åœ¨ä½¿ç”¨ XML é…ç½®æ–‡ä»¶çš„æ–¹å¼æ³¨å†Œ bean æ—¶ï¼Œå¯ä»¥é€šè¿‡ bean æ ‡ç­¾ä¸­çš„ property å­æ ‡ç­¾ç»™ bean ä¸­çš„å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.springframework.org/schema/beans"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
  <bean id="person" class="fun.xiaorang.springboot.annotation.pojo.Person">
    <property name="name" value="xiaorang"/>
    <property name="age" value="18"/>
    <property name="pet" ref="pet"/>
  </bean>

  <bean id="pet" class="fun.xiaorang.springboot.annotation.pojo.Pet">
    <property name="name" value="xiaobai"/>
    <property name="age" value="2"/>
  </bean>
</beans>
```

å…¶ä¸­ï¼Œproperty æ ‡ç­¾ä¸­çš„ name å±æ€§ä¸º bean ä¸­å­—æ®µçš„åç§°ï¼Œvalue å±æ€§ä¸ºè¦èµ‹ç»™ bean ä¸­å¯¹åº”å­—æ®µçš„å€¼ã€‚ é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨æ³¨è§£çš„æ–¹å¼ç»™ bean ä¸­çš„å±æ€§èµ‹å€¼å‘¢ï¼Ÿæ­¤æ—¶ï¼Œå°±éœ€è¦ç”¨åˆ° @Value æ³¨è§£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Target({ElementType.FIELD, ElementType.METHOD, ElementType.PARAMETER, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Value {

    /**
	 * The actual value expression such as <code>#{systemProperties.myProp}</code>
	 * or property placeholder such as <code>${my.app.myProp}</code>.
	 */
    String value();

}
```

ç”± @Value æ³¨è§£çš„å®šä¹‰å¯çŸ¥ï¼Œ

- å¯ä»¥æ ‡æ³¨åœ¨å­—æ®µã€æ–¹æ³•ã€å‚æ•°ä»¥åŠæ³¨è§£ä¸Šï¼Œå¹¶ä¸”åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ç”Ÿæ•ˆï¼›
- è¯¥æ³¨è§£çš„ä¸»è¦ä½œç”¨æ˜¯å®Œæˆå¯¹å±æ€§çš„èµ‹å€¼ï¼Œæ”¯æŒå…«ç§åŸºæœ¬ç±»å‹ï¼ŒStringï¼ŒSpEL è¡¨è¾¾å¼`#{}`ä»¥åŠå±æ€§å ä½ç¬¦`${}`ï¼ˆé€šè¿‡è¯»å–é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„ KEY è·å–ä¸ä¹‹å¯¹åº”çš„ VALUE å€¼ï¼Œé…ç½®æ–‡ä»¶æ”¯æŒ propertiesï¼Œyml å’Œ xml æ–‡ä»¶ï¼‰ï¼›å…³äº SpEL è¡¨è¾¾å¼çš„é«˜çº§ç”¨æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ [SpEL è¡¨è¾¾å¼](https://docs.spring.io/spring-framework/docs/6.0.8/reference/html/core.html#expressions)

**ğŸ“ éœ€æ±‚**ï¼šä½¿ç”¨ @Configuration + @Bean æ³¨è§£çš„æ–¹å¼å‘ IoC å®¹å™¨ä¸­æ³¨å†Œ Teacher ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨ @Value æ³¨è§£ç»™ç»„ä»¶ä¸­çš„å±æ€§èµ‹å€¼ã€‚å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

1. Teacher ç±»

   ```java
   public class Teacher {
       /**
        * Stringç±»å‹
        */
       @Value("å°è®©")
       private String name;
   
       @Value("2023-05-17 00:10:05")
       private Date birthday;
   
       /**
        * SpELè¡¨è¾¾å¼
        */
       @Value("#{30-3}")
       private int age;
   
       @Value("#{T(Math).random()}")
       private double salary;
   
       /**
        * ä»ç¯å¢ƒå˜é‡(Environment)ä¸­å–å€¼
        */
       @Value("${teacher.workDate}")
       private String workDate;
   
       /**
        * ä»ç¯å¢ƒå˜é‡ä¸­å–å€¼ï¼Œå¦‚æœæ²¡æœ‰è¯¥é…ç½®ï¼Œåˆ™ç»™ä¸€ä¸ªé»˜è®¤å€¼
        */
       @Value("${teacher.teach:english}")
       private String teach;
   
       @Override
       public String toString() {
           return "Teacher{" +
                   "name='" + name + '\'' +
                   ", birthday=" + birthday +
                   ", age=" + age +
                   ", salary=" + salary +
                   ", workDate='" + workDate + '\'' +
                   ", teach='" + teach + '\'' +
                   '}';
       }
   }
   ```

2. é…ç½®ç±» MainConfig ä¸­å¢åŠ è¢« @Bean æ³¨è§£æ ‡æ³¨çš„æ–°æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›å€¼ä¸º Teacher ç±»å‹

   ```java
   @Configuration(proxyBeanMethods = false)
   @Import({Color.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class})
   public class MainConfig {
       @Bean
       public Person person(Pet pet) {
           return new Person("xiaorang", 18, pet);
       }
   
       @Bean
       public Pet pet() {
           return new Pet("xiaobai", 2);
       }
   
       @Bean(initMethod = "initMethod", destroyMethod = "destroyMethod")
       public Cat cat() {
           return new Cat();
       }
   
       @Bean
       public Teacher teacher() {
           return new Teacher();
       }
   }
   ```

3. å¢åŠ æµ‹è¯•æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```java
   @Test
   public void test_05(ApplicationContext applicationContext) {
       Teacher teacher = applicationContext.getBean(Teacher.class);
       System.out.println(teacher);
   }
   ```

   æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![7f82e28b-472c-40a1-a488-eb8c04943b36](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252305095.png)<br />å‘ç°æŠ›å‡ºå¦‚ä¸Šå¼‚å¸¸ä¿¡æ¯ï¼Œæ— æ³•å°†æ ¼å¼ä¸º "yyyy-MM-dd" çš„æ—¥æœŸç±»å‹å­—ç¬¦ä¸²è½¬æ¢æˆ Date ç±»å‹ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ

   - å°†æ—¥æœŸæ ¼å¼æ›´æ¢ä¸º "yyyy/MM/dd"

   - å¢åŠ è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼Œå¯ä»¥å‚è€ƒ [Spring-IOC ç¯‡](./Spring-IOCç¯‡.md) æ–‡ç« æˆ–è€…ä»¥ä¸‹å®˜æ–¹æ–‡æ¡£å†…å®¹ [Core Technologies - Using @Value](https://docs.spring.io/spring-framework/docs/6.0.8/reference/html/core.html#beans-value-annotations)

     > Built-in converter support provided by Spring allows simple type conversion (to Integer or int for example) to be automatically handled. Multiple comma-separated values can be automatically converted to String array without extra effort.
     > A Spring BeanPostProcessor uses a ConversionService behind the scenes to handle the process for converting the String value in @Value to the target type. If you want to provide conversion support for your own custom type, you can provide your own ConversionService bean instance as the following example shows:

     ```java
     @Configuration
     public class AppConfig {
     
         @Bean
         public ConversionService conversionService() {
             DefaultFormattingConversionService conversionService = new DefaultFormattingConversionService();
             conversionService.addConverter(new MyCustomConverter());
             return conversionService;
         }
     }
     ```

   å’±ä»¬ä½¿ç”¨ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼šå¢åŠ è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼Œå®ç°æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š

   1. è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨

      ```java
      public class MyDateConverter implements Converter<String, Date> {
          private String pattern = "yyyy/MM/dd HH:mm:ss";
      
          public MyDateConverter() {
          }
      
          public MyDateConverter(String pattern) {
              this.pattern = pattern;
          }
      
          @Override
          public Date convert(String source) {
              try {
                  SimpleDateFormat sdf = new SimpleDateFormat(pattern);
                  return sdf.parse(source);
              } catch (ParseException e) {
                  e.printStackTrace();
              }
              return null;
          }
      }
      ```

   2. ä½¿ç”¨ @Configuration + @Bean æ³¨è§£çš„æ–¹å¼å‘ IoC å®¹å™¨ä¸­æ³¨å†Œ ConversionService ç»„ä»¶ï¼Œç»„ä»¶çš„åç§°å¿…é¡»ä¸º conversionServiceï¼Œå¦åˆ™çš„è¯ä¸ä¼šç”Ÿæ•ˆï¼

      ```java
      @Configuration(proxyBeanMethods = false)
      @Import({Color.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class})
      public class MainConfig {
          @Bean
          public Person person(Pet pet) {
              return new Person("xiaorang", 18, pet);
          }
      
          @Bean
          public Pet pet() {
              return new Pet("xiaobai", 2);
          }
      
          @Bean(initMethod = "initMethod", destroyMethod = "destroyMethod")
          public Cat cat() {
              return new Cat();
          }
      
          @Bean
          public Teacher teacher() {
              return new Teacher();
          }
      
          @Bean
          public ConversionService conversionService() {
              DefaultFormattingConversionService conversionService = new DefaultFormattingConversionService();
              conversionService.addConverter(new MyDateConverter("yyyy-MM-dd HH:mm:ss"));
              // å¦‚æœæ·»åŠ åŒç§ String -> Date çš„ç±»å‹è½¬æ¢å™¨ï¼Œåé¢æ·»åŠ çš„ä¼šç”Ÿæ•ˆ
              // conversionService.addConverter(new MyDateConverter());
              return conversionService;
          }
      }
      ```

   å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![68862dde-3006-4a6d-ad4c-50126e1eca2e](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252308249.png)<br />å‘ç°æŠ›å‡ºå¦‚ä¸Šå¼‚å¸¸ä¿¡æ¯ï¼Œæ— æ³•è§£æ ${teacher.workDate} ä¸­çš„å ä½ç¬¦ä¿¡æ¯ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥å¦‚ä½•è§£å†³è¯¥å¼‚å¸¸å‘¢ï¼Ÿå…¶å®éå¸¸ç®€å•ï¼Œåœ¨ resources èµ„æºç›®å½•ä¸‹å¢åŠ  application.yml é…ç½®æ–‡ä»¶å³å¯ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š

   ```yaml
   teacher:
     workDate: 2022-05-17 01:51:10
   ```

   å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![ff4921d0-f033-4b69-80a3-f94163684908](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252309300.png)

## è‡ªåŠ¨è£…é…

åœ¨ XML é…ç½®æ–‡ä»¶ä¸­ç»™ä¸€ä¸ª bean ä¸­çš„å±æ€§æ³¨å…¥å¦ä¸€ä¸ª bean æ—¶ï¼Œéœ€è¦ç”¨åˆ° property æ ‡ç­¾ä¸­çš„ ref å±æ€§ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.springframework.org/schema/beans"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
  <bean id="person" class="fun.xiaorang.springboot.annotation.pojo.Person">
    <property name="name" value="xiaorang"/>
    <property name="age" value="18"/>
    <property name="pet" ref="pet"/>
  </bean>

  <bean id="pet" class="fun.xiaorang.springboot.annotation.pojo.Pet">
    <property name="name" value="xiaobai"/>
    <property name="age" value="2"/>
  </bean>
</beans>
```

é‚£ä¹ˆè¯¥å¦‚ä½•ä½¿ç”¨æ³¨è§£çš„æ–¹å¼å®Œæˆå±æ€§å¡«å……/ä¾èµ–æ³¨å…¥å‘¢ï¼Ÿæ­¤æ—¶ï¼Œå°±éœ€è¦ç”¨åˆ°ä»¥ä¸‹å‡ ä¸ªæ³¨è§£ï¼š

### @Autowired

[Core Technologies - Using @Autowired](https://docs.spring.io/spring-framework/docs/6.0.8/reference/html/core.html#beans-autowired-annotation)

```java
@Target({ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Autowired {

    /**
	 * Declares whether the annotated dependency is required.
	 * <p>Defaults to {@code true}.
	 */
    boolean required() default true;

}
```

ç”± @Autowired æ³¨è§£çš„å®šä¹‰å¯çŸ¥ï¼Œè¯¥æ³¨è§£å¯ä»¥æ ‡æ³¨åœ¨æ„é€ æ–¹æ³•ã€æ–¹æ³•ã€å‚æ•°ã€å­—æ®µä»¥åŠæ³¨è§£ä¸Šã€‚<br />**ğŸ“ éœ€æ±‚**ï¼šä½¿ç”¨ @ComponentScan + @Component æ³¨è§£çš„æ–¹å¼å‘ IoC å®¹å™¨ä¸­æ³¨å†Œ OrderController å’Œ OrderService ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨ @Autowired æ³¨è§£å®Œæˆç»„ä»¶ä¸­å±æ€§çš„ä¾èµ–æ³¨å…¥ã€‚å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

1. OrderController å’Œ OrderService æ¥å£åŠå…¶å®ç°ç±» OrderServiceImpl1

   ```java
   public interface OrderService {
   
   }
   ```

   ```java
   @Service
   public class OrderServiceImpl1 implements OrderService {
   
   }
   ```

   ```java
   @Controller
   public class OrderController {
       // æç¤ºä¸å»ºè®®ä½¿ç”¨å­—æ®µæ³¨å…¥
       // @Autowired
       private OrderService orderService;
   
       public OrderService getOrderService() {
           return orderService;
       }
   
       @Autowired
       public void setOrderService(OrderService orderService) {
           this.orderService = orderService;
       }
   
       @Override
       public String toString() {
           return "OrderController{" +
                   "orderService=" + orderService +
                   '}';
       }
   }
   ```

2. åœ¨é…ç½®ç±» MainConfig ä¸Šå¢åŠ  @ComponentScan æ³¨è§£ç”¨äºæ‰«æ OrderController å’Œ OrderService ç»„ä»¶

   ```java
   @Configuration(proxyBeanMethods = false)
   @Import({Color.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class})
   @ComponentScan(value = "fun.xiaorang.springboot.annotation", includeFilters = {
           @ComponentScan.Filter(type = ASSIGNABLE_TYPE, classes = {OrderController.class}),
           @ComponentScan.Filter(type = ASSIGNABLE_TYPE, classes = {OrderService.class}),
   }, useDefaultFilters = false)
   public class MainConfig {
       @Bean
       public Person person(Pet pet) {
           return new Person("xiaorang", 18, pet);
       }
   
       @Bean
       public Pet pet() {
           return new Pet("xiaobai", 2);
       }
   
       @Bean(initMethod = "initMethod", destroyMethod = "destroyMethod")
       public Cat cat() {
           return new Cat();
       }
   
       @Bean
       public Teacher teacher() {
           return new Teacher();
       }
   
       @Bean
       public ConversionService conversionService() {
           DefaultFormattingConversionService conversionService = new DefaultFormattingConversionService();
           conversionService.addConverter(new MyDateConverter("yyyy-MM-dd HH:mm:ss"));
           // å¦‚æœæ·»åŠ åŒç§ String -> Date çš„ç±»å‹è½¬æ¢å™¨ï¼Œåé¢æ·»åŠ çš„ä¼šç”Ÿæ•ˆ
           // conversionService.addConverter(new MyDateConverter());
           return conversionService;
       }
   }
   ```

3. å¢åŠ æµ‹è¯•æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```java
   @Test
   public void test_06(ApplicationContext applicationContext) {
       OrderController orderController = applicationContext.getBean(OrderController.class);
       System.out.println(orderController);
   }
   ```

   æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![71c5ac3d-e804-435f-8865-1b802725c3ea](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252311442.png)<br />

â— éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@Autowired æ³¨è§£é»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹è¿›è¡Œè£…é…çš„ã€‚é‚£ä¹ˆå½“å­˜åœ¨å¤šä¸ªç±»å‹ç›¸åŒçš„ç»„ä»¶æ—¶è¯¥å¦‚ä½•è¿›è¡Œè£…é…å‘¢ï¼Ÿ ä¸¾ä¸ªæ —å­ï¼Œå½“ OrderService æ¥å£å­˜åœ¨ä¸¤ä¸ªå®ç°ç±» OrderServiceImpl1 å’Œ OrderServiceImpl2 æ—¶ï¼Œå¢åŠ ä¸€ä¸ª OrderServiceImpl2 å®ç°ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Service
public class OrderServiceImpl2 implements OrderService {

}
```

å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![45a51738-0c45-404e-8321-66cf40168341](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252312295.png)<br />å‘ç°æŠ›å‡ºå¦‚ä¸Šå¼‚å¸¸ä¿¡æ¯ï¼ŒOrderController ç»„ä»¶éœ€è¦æ³¨å…¥å”¯ä¸€çš„ä¸€ä¸ª OrderService ç»„ä»¶ï¼Œä½†æ˜¯å´å‘ç° 2 ä¸ªåŒ¹é…çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆè§£å†³ï¼š

> [!IMPORTANT]
>
> <strong style="color:#ae3520;">@Autowired æ³¨è§£é»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹è¿›è¡Œè£…é…çš„ï¼Œå½“æ‰¾åˆ°å¤šä¸ªç›¸åŒç±»å‹çš„ç»„ä»¶æ—¶ï¼Œå°†ç»§ç»­æŒ‰ç…§å±æ€§åç§°å»åŒ¹é…</strong>ã€‚

1. ä¿®æ”¹å±æ€§åç§°ï¼Œä¿®æ”¹ OrderController ç±»ä¸­çš„ orderService å±æ€§åæ”¹æˆ orderServiceImpl1ï¼›

   ```java
   @Controller
   public class OrderController {
       // æç¤ºä¸å»ºè®®ä½¿ç”¨å­—æ®µæ³¨å…¥
       // @Autowired
       private OrderService orderServiceImpl1;
   
       public OrderService getOrderServiceImpl1() {
           return orderServiceImpl1;
       }
   
       @Autowired
       public void setOrderServiceImpl1(OrderService orderServiceImpl1) {
           this.orderServiceImpl1 = orderServiceImpl1;
       }
   
       @Override
       public String toString() {
           return "OrderController{" +
                   "orderService=" + orderServiceImpl1 +
                   '}';
       }
   }
   ```

2. æ­é… @Qualifier æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥æ˜ç¡®æŒ‡å®šéœ€è¦è£…é…å“ªä¸ªç»„ä»¶

   ```java
   @Controller
   public class OrderController {
       // æç¤ºä¸å»ºè®®ä½¿ç”¨å­—æ®µæ³¨å…¥
       // @Autowired
       private OrderService orderService;
   
       public OrderService getOrderService() {
           return orderService;
       }
   
       @Autowired
       @Qualifier("orderServiceImpl1")
       public void setOrderService(OrderService orderService) {
           this.orderService = orderService;
       }
   
       @Override
       public String toString() {
           return "OrderController{" +
                   "orderService=" + orderService +
                   '}';
       }
   }
   ```

3. åœ¨ç»„ä»¶ä¸Šæ ‡æ³¨ @Primary æ³¨è§£ï¼Œå½“å­˜åœ¨å¤šä¸ªç±»å‹ç›¸åŒçš„ç»„ä»¶æ—¶ï¼Œåˆ™ä¼šä¼˜å…ˆæ³¨å…¥æ ‡æ³¨äº† @Primary æ³¨è§£çš„ç»„ä»¶

   ```java
   @Service
   @Primary
   public class OrderServiceImpl1 implements OrderService {
   
   }
   ```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å±æ€§åä¸ @Primary æ³¨è§£ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä»¥ @Primary æ³¨è§£ä¸ºä¸»ï¼›å½“ @Qualifier æ³¨è§£ä¸ @Primary æ³¨è§£ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä»¥ @Qualifier æ³¨è§£ä¸ºä¸»ï¼›å› ä¸º @Autowired æ³¨è§£ä¸­çš„ required å±æ€§é»˜è®¤ä¸º trueï¼Œè¡¨ç¤ºå¿…é¡»æ‰¾åˆ°æŸä¸ª bean å®Œæˆä¾èµ–æ³¨å…¥ï¼Œå¦‚æœæ‰¾ä¸åˆ°çš„è¯ï¼Œåˆ™ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼å¦‚æœä¸æƒ³æŠ›å‡ºå¼‚å¸¸ï¼Œåªéœ€è¦å°† required å±æ€§ç½®ä¸º false å³å¯ã€‚

> [!TIP]
>
> @Autowired æ³¨è§£è™½ç„¶å¯ä»¥æ ‡æ³¨åœ¨æ–¹æ³•ã€å‚æ•°ã€å­—æ®µä»¥åŠæ³¨è§£ä¸Šï¼Œä½†æ˜¯<strong style="color:#ae3520;font-size:19px;">é˜¿é‡Œå·´å·´æ‰‹å†Œå»ºè®®å’±ä»¬å°† @Autowired æ³¨è§£æ ‡æ³¨åœ¨æ„é€ æ–¹æ³•ä¸Š</strong>ï¼Œå¦‚æœæ ‡æ³¨åœ¨æ„é€ æ–¹æ³•ä¸Šï¼Œé‚£ä¹ˆæ„é€ æ–¹æ³•ä¸­çš„å‚æ•°ä¼šä» IoC å®¹å™¨ä¸­è·å–ï¼Œè€Œä¸”å½“åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆæ„é€ æ–¹æ³•ä¸Šæ ‡æ³¨çš„ @Autowired æ³¨è§£å¯ä»¥çœç•¥ã€‚

å°† OrderController ç±»æ”¹é€ æˆå¦‚ä¸‹å½¢å¼ï¼š

```java
@Controller
public class OrderController {
    private final OrderService orderService;

    public OrderController(@Qualifier("orderServiceImpl1") OrderService orderService) {
        this.orderService = orderService;
    }

    @Override
    public String toString() {
        return "OrderController{" +
                "orderService=" + orderService +
                '}';
    }
}
```

### @Resource

[Core Technologies - Injection with @Resource](https://docs.spring.io/spring-framework/docs/6.0.8/reference/html/core.html#beans-resource-annotation)

```java
@Target({TYPE, FIELD, METHOD})
@Retention(RUNTIME)
@Repeatable(Resources.class)
public @interface Resource {
    /**
     * The JNDI name of the resource.  For field annotations,
     * the default is the field name.  For method annotations,
     * the default is the JavaBeans property name corresponding
     * to the method.  For class annotations, there is no default
     * and this must be specified.
     */
    String name() default "";

    /**
     * The name of the resource that the reference points to. It can
     * link to any compatible resource using the global JNDI names.
     *
     * @since 1.7, Common Annotations 1.1
     */

    String lookup() default "";

    /**
     * The Java type of the resource.  For field annotations,
     * the default is the type of the field.  For method annotations,
     * the default is the type of the JavaBeans property.
     * For class annotations, there is no default and this must be
     * specified.
     */
    Class<?> type() default java.lang.Object.class;

    /**
     * The two possible authentication types for a resource.
     */
    enum AuthenticationType {
	    CONTAINER,
	    APPLICATION
    }

    /**
     * The authentication type to use for this resource.
     * This may be specified for resources representing a
     * connection factory of any supported type, and must
     * not be specified for resources of other types.
     */
    AuthenticationType authenticationType() default AuthenticationType.CONTAINER;

    /**
     * Indicates whether this resource can be shared between
     * this component and other components.
     * This may be specified for resources representing a
     * connection factory of any supported type, and must
     * not be specified for resources of other types.
     */
    boolean shareable() default true;

    /**
     * A product-specific name that this resource should be mapped to.
     * The <code>mappedName</code> element provides for mapping the
     * resource reference to the name of a resource known to the
     * applicaiton server.  The mapped name could be of any form.
     * <p>Application servers are not required to support any particular
     * form or type of mapped name, nor the ability to use mapped names.
     * The mapped name is product-dependent and often installation-dependent.
     * No use of a mapped name is portable.</p>
     */
    String mappedName() default "";

    /**
     * Description of this resource.  The description is expected
     * to be in the default language of the system on which the
     * application is deployed.  The description can be presented
     * to the Deployer to help in choosing the correct resource.
     */
    String description() default "";
}
```

ç”± @Resource æ³¨è§£çš„å®šä¹‰å¯çŸ¥ï¼Œè¯¥æ³¨è§£å¯ä»¥æ ‡æ³¨åœ¨ç±»ã€å­—æ®µä»¥åŠæ–¹æ³•ä¸Šã€‚è¯¥æ³¨è§£å±äº JSR250 è§„èŒƒä¸­å®šä¹‰çš„ä¸€ä¸ªæ³¨è§£ï¼Œæ³¨è§£ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ name å’Œ typeã€‚

- å¦‚æœåŒæ—¶æŒ‡å®šäº† name å±æ€§ å’Œ type å±æ€§ï¼Œåˆ™ä» IoC å®¹å™¨ä¸­æ‰¾ä¸€ä¸ªåç§°ä¸ name å±æ€§å¹¶ä¸”ç±»å‹ä¸ type å±æ€§éƒ½ç›¸åŒçš„ç»„ä»¶ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ¥é”™ï¼›
- å¦‚æœåªæŒ‡å®šäº† name å±æ€§ï¼Œåˆ™ä» IoC å®¹å™¨ä¸­æ‰¾ä¸€ä¸ªåç§°ä¸ name å±æ€§ç›¸åŒçš„ç»„ä»¶ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ¥é”™ï¼›
- å¦‚æœåªæŒ‡å®šäº† type å±æ€§ï¼Œåˆ™ä» IoC å®¹å™¨ä¸­æ‰¾ä¸€ä¸ªç±»å‹ä¸ type å±æ€§ç›¸åŒçš„ç»„ä»¶ï¼Œæ‰¾ä¸åˆ°æˆ–è€…æ‰¾åˆ°å¤šä¸ªç±»å‹ç›¸åŒçš„ç»„ä»¶åˆ™æŠ¥é”™ï¼›
- å¦‚æœä¸¤ä¸ªå±æ€§éƒ½æ²¡æœ‰æŒ‡å®šï¼Œåˆ™é»˜è®¤æŒ‰ç…§åç§°è¿›è¡Œè£…é…ï¼Œå¦‚æœæŒ‰åç§°æ‰¾ä¸åˆ°åˆ™æŒ‰ç±»å‹è¿›è¡Œè£…é…ï¼Œå¦‚æœæ‰¾åˆ°å¤šä¸ªç±»å‹ç›¸åŒçš„ç»„ä»¶åˆ™åˆ¤æ–­å…¶ä¸­æŸä¸ªç»„ä»¶ä¸Šæ˜¯å¦å­˜åœ¨æ ‡æ³¨ @Primary æ³¨è§£ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œåˆ™æŠ¥æ‰¾åˆ°å¤šä¸ªç»„ä»¶çš„å¼‚å¸¸ï¼›æœ€åï¼Œå¦‚æœæŒ‰ç±»å‹è¿˜æ˜¯æ‰¾ä¸åˆ°åˆ™æŠ¥é”™ï¼›

ä¸ºäº†æµ‹è¯• @Resource æ³¨è§£ï¼Œä¿®æ”¹åŸæœ‰çš„ OrderController å’Œ OrderServiceImpl1 ç±»ï¼ˆå»é™¤æ ‡æ³¨çš„ @Primary æ³¨è§£ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Controller
public class OrderController {
    @Resource
    private OrderService orderService;

    public OrderService getOrderService() {
        return orderService;
    }

    public void setOrderService(OrderService orderService) {
        this.orderService = orderService;
    }

    @Override
    public String toString() {
        return "OrderController{" +
        "orderService=" + orderService +
        '}';
    }
}
```

```java
@Service
public class OrderServiceImpl1 implements OrderService {

}
```

å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![9db1484e-2df6-4a5a-84f5-f5d6f3cc6839](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252317719.png)<br />å‘ç°æŠ›å‡ºå¦‚ä¸Šå¼‚å¸¸ä¿¡æ¯ï¼ŒOrderController ç»„ä»¶éœ€è¦æ³¨å…¥å”¯ä¸€çš„ä¸€ä¸ª OrderService ç»„ä»¶ï¼Œä½†æ˜¯å´å‘ç° 2 ä¸ªåŒ¹é…çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆè§£å†³ï¼š

1. åœ¨ @Autowired æ³¨è§£ä¸­çš„è§£å†³æ–¹æ¡ˆåœ¨æ­¤å¤„éƒ½é€‚ç”¨ï¼Œå¦‚ä¿®æ”¹å±æ€§åï¼Œæ­é… @Qualifier æ³¨è§£ä¸€èµ·ä½¿ç”¨æˆ–è€…åœ¨ç»„ä»¶ä¸Šæ ‡æ³¨ @Primary æ³¨è§£ï¼›

2. æŒ‡å®š @Reaource æ³¨è§£ä¸­çš„ name å±æ€§ï¼›

   ```java
   @Controller
   public class OrderController {
       @Resource(name = "orderServiceImpl1")
       private OrderService orderService;
   
       public OrderService getOrderService() {
           return orderService;
       }
   
       public void setOrderService(OrderService orderService) {
           this.orderService = orderService;
       }
   
       @Override
       public String toString() {
           return "OrderController{" +
                   "orderService=" + orderService +
                   '}';
       }
   }
   ```

   å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![65209c51-4929-4dac-bc46-6da972e77948](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252318762.png)

### @Inject

[Core Technologies - Dependency Injection with @Inject and @Named](https://docs.spring.io/spring-framework/docs/6.0.8/reference/html/core.html#beans-inject-named)

Spring æä¾›äº†å¯¹ JSR-330 æ ‡å‡†æ³¨è§£(ä¾èµ–æ³¨å…¥)çš„æ”¯æŒï¼Œæƒ³ä½¿ç”¨ @Inject æ³¨è§£éœ€è¦å¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>javax.inject</groupId>
    <artifactId>javax.inject</artifactId>
    <version>1</version>
</dependency>
```

@Inject æ³¨è§£çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Target({ METHOD, CONSTRUCTOR, FIELD })
@Retention(RUNTIME)
@Documented
public @interface Inject {}
```

ç”± @Inject æ³¨è§£çš„å®šä¹‰å¯çŸ¥ï¼Œè¯¥æ³¨è§£å¯ä»¥æ ‡æ³¨åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•ä»¥åŠå­—æ®µä¸Šã€‚è¯¥æ³¨è§£å¯ä»¥ä»£æ›¿ @Autowired æ³¨è§£ï¼Œæ­é… @Named æ³¨è§£ï¼ˆä¸ Qualifier æ³¨è§£åŠŸèƒ½ä¸€æ ·ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥æ˜ç¡®æŒ‡å®šéœ€è¦è£…é…å“ªä¸ªç»„ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Controller
public class OrderController {
    private OrderService orderService;

    public OrderService getOrderService() {
        return orderService;
    }

    @Inject
    @Named("orderServiceImpl2")
    public void setOrderService(OrderService orderService) {
        this.orderService = orderService;
    }

    @Override
    public String toString() {
        return "OrderController{" +
        "orderService=" + orderService +
        '}';
    }
}
```

å†æ¬¡æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![cd9436b5-c8a5-4bc3-9af2-c140c30eb85f](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202307252320825.png)

## å…¶ä»–

<strong style="color:#ae3520;">TODO</strong>

- @Conditional
- @ImportResource
- @PropertySource
- @ConfigurationProperties + @EnableConfigurationProperties
- @Scope
- @Lazy
- @profile