# å¾…åŠæ¸…å• v2.0

> ç›¸è¾ƒäº[ç¬¬ä¸€ç‰ˆå¾…åŠæ¸…å•](./å¾…åŠæ¸…å•.md)è€Œè¨€ï¼Œå¾…åŠæ¸…å• 2.0 ç‰ˆæœ¬å‡çº§ä¸ºç”±å¤šä¸ªç»„ä»¶æ„æˆæ•´ä¸ªåº”ç”¨ï¼Œä½¿ç”¨ `pinia` è¿›è¡ŒçŠ¶æ€å­˜å‚¨ã€‚
>
> é¡¹ç›®ä»“åº“åœ°å€ï¼š[xihuanxiaorang/todos (github.com)](https://github.com/xihuanxiaorang/todos)ï¼Œæœ‰éœ€è¦çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œä¸‹è½½ã€‚

## åˆ›å»ºé¡¹ç›®

ä½¿ç”¨ `pnpm create vue@latest` å‘½ä»¤åˆ›å»ºé¡¹ç›®ï¼Œé¡¹ç›®åç§°ä¸º `todomvc`ã€‚<br />![image-20240322105400533](https://cdn.jsdelivr.net/gh/xihuanxiaorang/img/202403221054943.png)

åœ¨é¡¹ç›®è¢«åˆ›å»ºåï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å®‰è£…ä¾èµ–å¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![image-20240322105537736](https://cdn.jsdelivr.net/gh/xihuanxiaorang/img/202403221055492.png)

## å‡†å¤‡å·¥ä½œ

> [!tip]
>
> å¯¹äºæœ¬é¡¹ç›®ï¼Œå’±ä»¬çš„ç²¾åŠ›åº”è¯¥é›†ä¸­åœ¨ä½¿ç”¨ Vue3 ç¼–å†™å…¶ä¸šåŠ¡é€»è¾‘ï¼Œè‡³äº HTML é¡µé¢å’Œ CSS æ ·å¼å¯ä»¥åˆ° TodoMVC å®˜æ–¹çš„ Github ä»“åº“ä¸­è¿›è¡Œä¸‹è½½ã€‚

1. é¦–å…ˆï¼Œåˆ é™¤æˆ–è€…æ¸…ç©ºæ‰€æœ‰ä¸éœ€è¦çš„å†…å®¹ï¼›

   1. åˆ é™¤ `components` ç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶å’Œ `assets` ç›®å½•ä¸‹çš„ `base.css` æ ·å¼æ–‡ä»¶ï¼›
   2. åˆ é™¤ `views` ç›®å½•ä¸‹çš„ `HomeView` å’Œ `AboutView` ç»„ä»¶ï¼›
   3. åˆ é™¤ `stores` ç›®å½•ä¸‹çš„ `counter.ts` æ–‡ä»¶ï¼›
   4. æ¸…ç©º `App.vue` ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œåªåœ¨ `template` æ¨¡æ¿ä¸­ä¿ç•™ä¸€ä¸ªè·¯ç”±å‡ºå£ `<RouterView />`ï¼›
   5. æ¸…ç©º `assets` ç›®å½•ä¸‹ `main.css` æ ·å¼æ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰æ ·å¼ï¼›

2. ä» TodoMVC å®˜æ–¹ Github ä»“åº“ [tastejs/todomvc-app-css: CSS for TodoMVC apps (github.com)](https://github.com/tastejs/todomvc-app-css) å°† `index.css` ä¸­çš„æ‰€æœ‰æ ·å¼æ‹·è´åˆ° `main.css`ï¼›

   ```css
   @charset 'utf-8';
   
   html,
   body {
   	margin: 0;
   	padding: 0;
   }
   
   button {
   	margin: 0;
   	padding: 0;
   	border: 0;
   	background: none;
   	font-size: 100%;
   	vertical-align: baseline;
   	font-family: inherit;
   	font-weight: inherit;
   	color: inherit;
   	-webkit-appearance: none;
   	appearance: none;
   	-webkit-font-smoothing: antialiased;
   	-moz-osx-font-smoothing: grayscale;
   }
   
   body {
   	font: 14px 'Helvetica Neue', Helvetica, Arial, sans-serif;
   	line-height: 1.4em;
   	background: #f5f5f5;
   	color: #111111;
   	min-width: 230px;
   	max-width: 550px;
   	margin: 0 auto;
   	-webkit-font-smoothing: antialiased;
   	-moz-osx-font-smoothing: grayscale;
   	font-weight: 300;
   }
   
   .hidden {
   	display: none;
   }
   
   .todoapp {
   	background: #fff;
   	margin: 130px 0 40px 0;
   	position: relative;
   	box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2),
   	            0 25px 50px 0 rgba(0, 0, 0, 0.1);
   }
   
   .todoapp input::-webkit-input-placeholder {
   	font-style: italic;
   	font-weight: 400;
   	color: rgba(0, 0, 0, 0.4);
   }
   
   .todoapp input::-moz-placeholder {
   	font-style: italic;
   	font-weight: 400;
   	color: rgba(0, 0, 0, 0.4);
   }
   
   .todoapp input::input-placeholder {
   	font-style: italic;
   	font-weight: 400;
   	color: rgba(0, 0, 0, 0.4);
   }
   
   .todoapp h1 {
   	position: absolute;
   	top: -140px;
   	width: 100%;
   	font-size: 80px;
   	font-weight: 200;
   	text-align: center;
   	color: #b83f45;
   	-webkit-text-rendering: optimizeLegibility;
   	-moz-text-rendering: optimizeLegibility;
   	text-rendering: optimizeLegibility;
   }
   
   .new-todo,
   .edit {
   	position: relative;
   	margin: 0;
   	width: 100%;
   	font-size: 24px;
   	font-family: inherit;
   	font-weight: inherit;
   	line-height: 1.4em;
   	color: inherit;
   	padding: 6px;
   	border: 1px solid #999;
   	box-shadow: inset 0 -1px 5px 0 rgba(0, 0, 0, 0.2);
   	box-sizing: border-box;
   	-webkit-font-smoothing: antialiased;
   	-moz-osx-font-smoothing: grayscale;
   }
   
   .new-todo {
   	padding: 16px 16px 16px 60px;
   	height: 65px;
   	border: none;
   	background: rgba(0, 0, 0, 0.003);
   	box-shadow: inset 0 -2px 1px rgba(0,0,0,0.03);
   }
   
   .main {
   	position: relative;
   	z-index: 2;
   	border-top: 1px solid #e6e6e6;
   }
   
   .toggle-all {
   	width: 1px;
   	height: 1px;
   	border: none; /* Mobile Safari */
   	opacity: 0;
   	position: absolute;
   	right: 100%;
   	bottom: 100%;
   }
   
   .toggle-all + label {
   	display: flex;
   	align-items: center;
   	justify-content: center;
   	width: 45px;
   	height: 65px;
   	font-size: 0;
   	position: absolute;
   	top: -65px;
   	left: -0;
   }
   
   .toggle-all + label:before {
   	content: 'â¯';
   	display: inline-block;
   	font-size: 22px;
   	color: #949494;
   	padding: 10px 27px 10px 27px;
   	-webkit-transform: rotate(90deg);
   	transform: rotate(90deg);
   }
   
   .toggle-all:checked + label:before {
   	color: #484848;
   }
   
   .todo-list {
   	margin: 0;
   	padding: 0;
   	list-style: none;
   }
   
   .todo-list li {
   	position: relative;
   	font-size: 24px;
   	border-bottom: 1px solid #ededed;
   }
   
   .todo-list li:last-child {
   	border-bottom: none;
   }
   
   .todo-list li.editing {
   	border-bottom: none;
   	padding: 0;
   }
   
   .todo-list li.editing .edit {
   	display: block;
   	width: calc(100% - 43px);
   	padding: 12px 16px;
   	margin: 0 0 0 43px;
   }
   
   .todo-list li.editing .view {
   	display: none;
   }
   
   .todo-list li .toggle {
   	text-align: center;
   	width: 40px;
   	/* auto, since non-WebKit browsers doesn't support input styling */
   	height: auto;
   	position: absolute;
   	top: 0;
   	bottom: 0;
   	margin: auto 0;
   	border: none; /* Mobile Safari */
   	-webkit-appearance: none;
   	appearance: none;
   }
   
   .todo-list li .toggle {
   	opacity: 0;
   }
   
   .todo-list li .toggle + label {
   	/*
   		Firefox requires `#` to be escaped - https://bugzilla.mozilla.org/show_bug.cgi?id=922433
   		IE and Edge requires *everything* to be escaped to render, so we do that instead of just the `#` - https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7157459/
   	*/
   	background-image: url('data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23949494%22%20stroke-width%3D%223%22/%3E%3C/svg%3E');
   	background-repeat: no-repeat;
   	background-position: center left;
   }
   
   .todo-list li .toggle:checked + label {
   	background-image: url('data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%2359A193%22%20stroke-width%3D%223%22%2F%3E%3Cpath%20fill%3D%22%233EA390%22%20d%3D%22M72%2025L42%2071%2027%2056l-4%204%2020%2020%2034-52z%22%2F%3E%3C%2Fsvg%3E');
   }
   
   .todo-list li label {
   	overflow-wrap: break-word;
   	padding: 15px 15px 15px 60px;
   	display: block;
   	line-height: 1.2;
   	transition: color 0.4s;
   	font-weight: 400;
   	color: #484848;
   }
   
   .todo-list li.completed label {
   	color: #949494;
   	text-decoration: line-through;
   }
   
   .todo-list li .destroy {
   	display: none;
   	position: absolute;
   	top: 0;
   	right: 10px;
   	bottom: 0;
   	width: 40px;
   	height: 40px;
   	margin: auto 0;
   	font-size: 30px;
   	color: #949494;
   	transition: color 0.2s ease-out;
   }
   
   .todo-list li .destroy:hover,
   .todo-list li .destroy:focus {
   	color: #C18585;
   }
   
   .todo-list li .destroy:after {
   	content: 'Ã—';
   	display: block;
   	height: 100%;
   	line-height: 1.1;
   }
   
   .todo-list li:hover .destroy {
   	display: block;
   }
   
   .todo-list li .edit {
   	display: none;
   }
   
   .todo-list li.editing:last-child {
   	margin-bottom: -1px;
   }
   
   .footer {
   	padding: 10px 15px;
   	height: 20px;
   	text-align: center;
   	font-size: 15px;
   	border-top: 1px solid #e6e6e6;
   }
   
   .footer:before {
   	content: '';
   	position: absolute;
   	right: 0;
   	bottom: 0;
   	left: 0;
   	height: 50px;
   	overflow: hidden;
   	box-shadow: 0 1px 1px rgba(0, 0, 0, 0.2),
   	            0 8px 0 -3px #f6f6f6,
   	            0 9px 1px -3px rgba(0, 0, 0, 0.2),
   	            0 16px 0 -6px #f6f6f6,
   	            0 17px 2px -6px rgba(0, 0, 0, 0.2);
   }
   
   .todo-count {
   	float: left;
   	text-align: left;
   }
   
   .todo-count strong {
   	font-weight: 300;
   }
   
   .filters {
   	margin: 0;
   	padding: 0;
   	list-style: none;
   	position: absolute;
   	right: 0;
   	left: 0;
   }
   
   .filters li {
   	display: inline;
   }
   
   .filters li a {
   	color: inherit;
   	margin: 3px;
   	padding: 3px 7px;
   	text-decoration: none;
   	border: 1px solid transparent;
   	border-radius: 3px;
   }
   
   .filters li a:hover {
   	border-color: #DB7676;
   }
   
   .filters li a.selected {
   	border-color: #CE4646;
   }
   
   .clear-completed,
   html .clear-completed:active {
   	float: right;
   	position: relative;
   	line-height: 19px;
   	text-decoration: none;
   	cursor: pointer;
   }
   
   .clear-completed:hover {
   	text-decoration: underline;
   }
   
   .info {
   	margin: 65px auto 0;
   	color: #4d4d4d;
   	font-size: 11px;
   	text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
   	text-align: center;
   }
   
   .info p {
   	line-height: 1;
   }
   
   .info a {
   	color: inherit;
   	text-decoration: none;
   	font-weight: 400;
   }
   
   .info a:hover {
   	text-decoration: underline;
   }
   
   /*
   	Hack to remove background from Mobile Safari.
   	Can't use it globally since it destroys checkboxes in Firefox
   */
   @media screen and (-webkit-min-device-pixel-ratio:0) {
   	.toggle-all,
   	.todo-list li .toggle {
   		background: none;
   	}
   
   	.todo-list li .toggle {
   		height: 40px;
   	}
   }
   
   @media (max-width: 430px) {
   	.footer {
   		height: 50px;
   	}
   
   	.filters {
   		bottom: 10px;
   	}
   }
   
   :focus,
   .toggle:focus + label,
   .toggle-all:focus + label {
   	box-shadow: 0 0 2px 2px #CF7D7D;
   	outline: 0;
   }
   ```

3. ä» TodoMVC å®˜æ–¹ Github ä»“åº“ [tastejs/todomvc-app-template: Template used for creating TodoMVC apps (github.com)](https://github.com/tastejs/todomvc-app-template) å°† `index.html` é¡µé¢ä¸­çš„ `body` ä¸­çš„å†…å®¹æ‹†åˆ†æˆå¦‚ä¸‹ä¸‰ä¸ªç»„ä»¶ï¼š

   ::: code-group

   ```vue [TodoHeader.vue]
   <script setup lang="ts"></script>
   
   <template>
     <header class="header">
       <h1>todos</h1>
       <input class="new-todo" placeholder="What needs to be done?" autofocus />
     </header>
   </template>
   
   <style scoped></style>
   ```

   ```vue [TodoMain.vue]
   <script setup lang="ts"></script>
   
   <template>
     <!-- This section should be hidden by default and shown when there are todos -->
     <section class="main">
       <input id="toggle-all" class="toggle-all" type="checkbox" />
       <label for="toggle-all">Mark all as complete</label>
       <ul class="todo-list">
         <!-- These are here just to show the structure of the list items -->
         <!-- List items should get the class `editing` when editing and `completed` when marked as completed -->
         <li class="completed">
           <div class="view">
             <input class="toggle" type="checkbox" checked />
             <label>Taste JavaScript</label>
             <button class="destroy"></button>
           </div>
           <input class="edit" value="Create a TodoMVC template" />
         </li>
         <li>
           <div class="view">
             <input class="toggle" type="checkbox" />
             <label>Buy a unicorn</label>
             <button class="destroy"></button>
           </div>
           <input class="edit" value="Rule the web" />
         </li>
       </ul>
     </section>
   </template>
   
   <style scoped></style>
   ```

   ```vue [TodoFooter.vue]
   <script setup lang="ts"></script>
   
   <template>
     <!-- This footer should be hidden by default and shown when there are todos -->
     <footer class="footer">
       <!-- This should be `0 items left` by default -->
       <span class="todo-count"><strong>0</strong> item left</span>
       <!-- Remove this if you don't implement routing -->
       <ul class="filters">
         <li>
           <a class="selected" href="#/">All</a>
         </li>
         <li>
           <a href="#/active">Active</a>
         </li>
         <li>
           <a href="#/completed">Completed</a>
         </li>
       </ul>
       <!-- Hidden if no completed items are left â†“ -->
       <button class="clear-completed">Clear completed</button>
     </footer>
   </template>
   
   <style scoped></style>
   ```

   :::

4. åœ¨ `views` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `TodoView` çš„ç»„ä»¶ï¼Œç„¶åå°†ä¸Šé¢æ‹†åˆ†å‡ºæ¥çš„ç»„ä»¶å¼•å…¥åˆ°è¯¥ç»„ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```vue
   <script setup lang="ts">
   import TodoHeader from '@/components/TodoHeader.vue'
   import TodoMain from '@/components/TodoMain.vue'
   import TodoFooter from '@/components/TodoFooter.vue'
   </script>
   
   <template>
     <section class="todoapp">
       <TodoHeader></TodoHeader>
       <TodoMain></TodoMain>
       <TodoFooter></TodoFooter>
     </section>
   </template>
   
   <style scoped></style>
   ```

5. ä¿®æ”¹è·¯ç”±æ–‡ä»¶ `router/index.ts` ä¸­çš„è·¯ç”±æ•°ç»„ `routes`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

   ```ts
   import { createRouter, createWebHistory } from 'vue-router'
   import TodoView from '@/views/TodoView.vue'
   
   const router = createRouter({
     history: createWebHistory(import.meta.env.BASE_URL),
     routes: [
       {
         path: '/',
         name: 'all',
         component: TodoView
       },
       {
         path: '/active',
         name: 'active',
         component: TodoView
       },
       {
         path: '/completed',
         name: 'completed',
         component: TodoView
       }
     ]
   })
   
   export default router
   ```

ä½¿ç”¨ `pnpm dev` å‘½ä»¤è¿è¡Œé¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°é¡¹ç›®çš„æ•´ä½“æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br />![image-20240321155717040](https://cdn.jsdelivr.net/gh/xihuanxiaorang/img/202403211557218.png)

## åŠŸèƒ½åˆ¶ä½œ

### æ¸²æŸ“å¾…åŠäº‹é¡¹åˆ—è¡¨

æ¶‰åŠåˆ°çš„ä¸»è¦åŠŸèƒ½ç‚¹ï¼š

- åœ¨æ–°å»ºçš„ `types` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªç±»å‹å£°æ˜æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å¾…åŠäº‹é¡¹çš„ç±»å‹ï¼›
- ä½¿ç”¨ `pinia` å®šä¹‰ä¸€ä¸ª `todos` å­˜å‚¨å¯¹è±¡ç”¨äºç®¡ç†æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ï¼›
- å°†å¾…åŠäº‹é¡¹æ‹†åˆ†æˆä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶ `TodoItem`ï¼›

ğŸ’¡æ³¨æ„ï¼šåœ¨ä½¿ç”¨ `v-for` æŒ‡ä»¤éå†å¾…åŠäº‹é¡¹åˆ—è¡¨æ—¶ï¼Œæ¯ä¸€æ¡å¾…åŠäº‹é¡¹ç»„ä»¶ `TodoItem` ä½¿ç”¨ `v-model` æŒ‡ä»¤è¿›è¡ŒåŒå‘ç»‘å®šï¼Œ**åœ¨è¿›è¡ŒåŒå‘ç»‘å®šæ—¶ä¸èƒ½ç›´æ¥ä½¿ç”¨å¾ªç¯å˜é‡æœ¬èº«**ï¼é‚£ä¹ˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ `array[index]` çš„æ–¹å¼è¿›è¡Œæ›¿ä»£ã€‚

::: code-group

```ts [todos.ts]
/**
 * å¾…åŠäº‹é¡¹
 */
export interface Todo {
  /* ç¼–å· */
  id: string
  /* æ ‡é¢˜ */
  title: string
  /* æ˜¯å¦å®Œæˆ */
  completed: boolean
}
```

```ts [todos.ts]
import { defineStore } from 'pinia'
import { ref } from 'vue'
import type { Todo } from '@/types/todos'

export const useTodosStore = defineStore('todos', () => {
  /**
   * å¾…åŠäº‹é¡¹åˆ—è¡¨
   */
  const todos = ref<Todo[]>([
    {
      id: '1',
      title: 'Taste JavaScript',
      completed: true
    },
    {
      id: '2',
      title: 'Buy a unicorn',
      completed: false
    }
  ])
  return { todos }
})
```

```vue [TodoMain.vue]
<script setup lang="ts">
import TodoItem from '@/components/TodoItem.vue'
import { storeToRefs } from 'pinia'
import { useTodosStore } from '@/stores/todos'

const { todos } = storeToRefs(useTodosStore())
</script>

<template>
  <!-- This section should be hidden by default and shown when there are todos -->
  <section class="main">
    <input id="toggle-all" class="toggle-all" type="checkbox" />
    <label for="toggle-all">Mark all as complete</label>
    <ul class="todo-list">
      <!-- These are here just to show the structure of the list items -->
      <!-- List items should get the class `editing` when editing and `completed` when marked as completed -->
      <TodoItem v-for="(todo, index) in todos" :key="todo.id" v-model="todos[index]" />
    </ul>
  </section>
</template>

<style scoped></style>
```

```vue [TodoItem.vue]
<script setup lang="ts">
import type { Todo } from '@/types/todos'

const todo = defineModel<Todo>({ required: true })
</script>

<template>
  <li :class="{ completed: todo.completed }">
    <div class="view">
      <input class="toggle" type="checkbox" v-model="todo.completed" />
      <label>{{ todo.title }}</label>
      <button class="destroy"></button>
    </div>
    <input class="edit" value="Create a TodoMVC template" />
  </li>
</template>

<style scoped></style>
```

:::

### æ·»åŠ å¾…åŠäº‹é¡¹

åœ¨ `TodoHeader` ç»„ä»¶ä¸­å®šä¹‰ä¸€ä¸ªå“åº”å¼å¯¹è±¡ `newTodo` ç”¨äºåŒå‘ç»‘å®š `input` è¾“å…¥æ¡†ä¸­çš„æ–°å»ºå¾…åŠäº‹é¡¹ï¼Œç„¶åç¼–å†™ä¸€ä¸ª `addTodo` æ–¹æ³•ç”¨äºå°†æ–°å»ºçš„å¾…åŠäº‹é¡¹æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚

::: code-group

```vue [TodoHeader.vue]
<script setup lang="ts">
import { ref } from 'vue'
import { useTodosStore } from '@/stores/todos'

const newTodo = ref('')
/**
 * ç”Ÿæˆuuid
 */
const uuid = () => {
  let uuid = ''
  for (let i = 0; i < 32; i++) {
    let random = (Math.random() * 16) | 0
    if (i === 8 || i === 12 || i === 16 || i === 20) uuid += '-'
    uuid += (i === 12 ? 4 : i === 16 ? (random & 3) | 8 : random).toString(16)
  }
  return uuid
}
/**
 * æ·»åŠ å¾…åŠäº‹é¡¹
 */
const addTodo = () => {
  if (!newTodo.value) return
  const { addTodo } = useTodosStore()
  addTodo({
    id: uuid(),
    title: newTodo.value,
    completed: false
  })
  newTodo.value = ''
}
</script>

<template>
  <header class="header">
    <RouterLink to="/"><h1>todos</h1></RouterLink>
    <input
      class="new-todo"
      placeholder="What needs to be done?"
      autofocus
      v-model.trim="newTodo"
      @keyup.enter="addTodo"
    />
  </header>
</template>

<style scoped></style>
```

```ts [todos.ts]
import { defineStore } from 'pinia'
import { ref } from 'vue'
import type { Todo } from '@/types/todos'

export const useTodosStore = defineStore('todos', () => {
  /**
   * å¾…åŠäº‹é¡¹åˆ—è¡¨
   */
  const todos = ref<Todo[]>([])
  /**
   * æ·»åŠ å¾…åŠäº‹é¡¹
   * @param todo ä»£åŠäº‹é¡¹
   */
  const addTodo = (todo: Todo) => {
    if (!todo) return
    todos.value.unshift(todo)
  }

  return {
    todos,
    addTodo
  }
})
```

:::

### åˆ é™¤å¾…åŠäº‹é¡¹

ç‚¹å‡»æ¯ä¸ªå¾…åŠäº‹é¡¹åé¢çš„âŒå·å®ç°åˆ é™¤åŠŸèƒ½ï¼Œå› æ­¤éœ€è¦åœ¨è¯¥âŒå·æŒ‰é’®ä¸Šæ·»åŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶çš„ç›‘å¬å™¨æ–¹æ³• `removeTodo`ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°ä¸ºè¦åˆ é™¤çš„å¾…åŠäº‹é¡¹ã€‚

::: code-group

```ts [todos.ts] {18-24,29}
import { defineStore } from 'pinia'
import { ref } from 'vue'
import type { Todo } from '@/types/todos'

export const useTodosStore = defineStore('todos', () => {
  /**
   * å¾…åŠäº‹é¡¹åˆ—è¡¨
   */
  const todos = ref<Todo[]>([])
  /**
   * æ·»åŠ å¾…åŠäº‹é¡¹
   * @param todo ä»£åŠäº‹é¡¹
   */
  const addTodo = (todo: Todo) => {
    if (!todo) return
    todos.value.unshift(todo)
  }
  /**
   * åˆ é™¤å¾…åŠäº‹é¡¹
   * @param todo å¾…åŠäº‹é¡¹
   */
  const removeTodo = (todo: Todo) => {
    todos.value.splice(todos.value.indexOf(todo), 1)
  }

  return {
    todos,
    addTodo,
    removeTodo
  }
})
```

```vue [TodoItem.vue] {3,6,14}
<script setup lang="ts">
import type { Todo } from '@/types/todos'
import { useTodosStore } from '@/stores/todos'

const todo = defineModel<Todo>({ required: true })
const { removeTodo } = useTodosStore()
</script>

<template>
  <li :class="{ completed: todo.completed }">
    <div class="view">
      <input class="toggle" type="checkbox" v-model="todo.completed" />
      <label>{{ todo.title }}</label>
      <button class="destroy" @click="removeTodo(todo)"></button>
    </div>
    <input class="edit" value="Create a TodoMVC template" />
  </li>
</template>

<style scoped></style>
```

:::

### ç¼–è¾‘å¾…åŠäº‹é¡¹

- åŒå‡»å·²æ·»åŠ çš„å¾…åŠäº‹é¡¹æ—¶ä¼šè¿›å…¥ç¼–è¾‘çŠ¶æ€ï¼Œæ˜¾ç¤ºç¼–è¾‘æ–‡æœ¬æ¡†å¹¶è‡ªåŠ¨è·å–ç„¦ç‚¹ï¼›
- æŒ‰å›è½¦é”®æˆ–è€…ä½¿ç¼–è¾‘æ–‡æœ¬æ¡†å¤±å»ç„¦ç‚¹åˆ™è¡¨ç¤ºç¡®è®¤ä¿®æ”¹ï¼›
- æŒ‰ ESC é”®åˆ™è¡¨ç¤ºå–æ¶ˆä¿®æ”¹ï¼›
- æŠŠç¼–è¾‘æ–‡æœ¬æ¡†æ¸…ç©ºå¹¶ç¡®è®¤ä¿®æ”¹åˆ™è¡¨ç¤ºåˆ é™¤å½“å‰å¾…åŠäº‹é¡¹ï¼›

::: code-group

```vue [TodoItem.vue] {4,8-33,40,45-50}
<script setup lang="ts">
import type { Todo } from '@/types/todos'
import { useTodosStore } from '@/stores/todos'
import { nextTick, ref } from 'vue'

const todo = defineModel<Todo>({ required: true })
const { removeTodo } = useTodosStore()
// æ˜¯å¦æ­£åœ¨ç¼–è¾‘æ ‡è¯†
const editing = ref(false)
// è·å–ç¼–è¾‘è¾“å…¥æ¡†çš„æ¨¡æ¿å¼•ç”¨ï¼Œä½¿å…¶åœ¨ç¼–è¾‘æ—¶èƒ½è‡ªåŠ¨è·å–ç„¦ç‚¹
const editInput = ref<HTMLInputElement>()
// ç”¨äºåŒå‘ç»‘å®šç¼–è¾‘è¾“å…¥æ¡†
const editingTitle = ref('')
/**
 * å¼€å§‹ç¼–è¾‘
 */
const startEdit = () => {
  editing.value = true
  editingTitle.value = todo.value.title
  nextTick(() => {
    editInput.value?.focus()
  })
}
/**
 * ç¡®è®¤ç¼–è¾‘
 */
const doneEdit = () => {
  if (editing.value) {
    editing.value = false
    if (!editingTitle.value) removeTodo(todo.value)
    todo.value.title = editingTitle.value
  }
}
</script>

<template>
  <li :class="{ completed: todo.completed, editing: editing }">
    <div class="view">
      <input class="toggle" type="checkbox" v-model="todo.completed" />
      <label @dblclick="startEdit">{{ todo.title }}</label>
      <button class="destroy" @click="removeTodo(todo)"></button>
    </div>
    <input
      class="edit"
      v-if="editing"
      ref="editInput"
      v-model="editingTitle"
      @keyup.enter="doneEdit"
      @blur="doneEdit"
      @keyup.esc="editing = false"
    />
  </li>
</template>

<style scoped></style>
```

:::

### åˆ‡æ¢å¾…åŠäº‹é¡¹çŠ¶æ€

- ç‚¹å‡»å…¨é€‰æŒ‰é’®ï¼ˆå¤´éƒ¨å‘ä¸‹çš„ç®­å¤´ï¼‰æ—¶æ”¹å˜æ‰€æœ‰å¾…åŠäº‹é¡¹çš„å‹¾é€‰çŠ¶æ€ï¼›
- ç‚¹å‡»ä¸‹æ–¹çš„ `All`ã€`Active` å’Œ `Completed` æŒ‰é’®æ—¶åˆ‡æ¢æ˜¾ç¤ºçš„å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼›
- è®¡ç®—æ‰€æœ‰æœªå®Œæˆçš„å¾…åŠäº‹é¡¹ä¸ªæ•°æ˜¾ç¤ºåœ¨å·¦ä¸‹æ–¹ï¼›
- ç‚¹å‡»å³ä¸‹æ–¹ `Clear completed` æŒ‰é’®æ—¶ç§»é™¤æ‰€æœ‰å·²å®Œæˆçš„å¾…åŠäº‹é¡¹ï¼›
- å½“æ²¡æœ‰ä»»ä½•å¾…åŠäº‹é¡¹æ—¶ï¼Œéšè—ä¸»ä½“å’Œåº•éƒ¨åŒºåŸŸï¼›

::: code-group

```ts [todos.ts] {2,4,8,11-30,46-58,62-64,67-68}
import { defineStore } from 'pinia'
import { computed, type Ref, ref } from 'vue'
import type { Todo } from '@/types/todos'
import { useRoute } from 'vue-router'

export const useTodosStore = defineStore('todos', () => {
  // è·¯ç”±å®ä¾‹
  const route = useRoute()
  // å¾…åŠäº‹é¡¹åˆ—è¡¨
  const todos = ref<Todo[]>([])
  // è¿‡æ»¤å™¨
  const filters = {
    active: (todos: Ref<Todo[]>) => todos.value.filter((todo) => !todo.completed),
    completed: (todos: Ref<Todo[]>) => todos.value.filter((todo) => todo.completed)
  }
  // æœªå®Œæˆçš„å¾…åŠäº‹é¡¹åˆ—è¡¨
  const activeTodos = computed(() => filters.active(todos))
  // å·²å®Œæˆçš„å¾…åŠäº‹é¡¹åˆ—è¡¨
  const completedTodos = computed(() => filters.completed(todos))
  // æ ¹æ®è·¯ç”±åç§°è¿‡æ»¤åçš„å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼Œç”¨äºæ˜¾ç¤ºä¸åŒçŠ¶æ€ä¸‹çš„å¾…åŠäº‹é¡¹åˆ—è¡¨
  const filteredTodos = computed(() => {
    switch (route.name) {
      case 'active':
        return activeTodos.value
      case 'completed':
        return completedTodos.value
      default:
        return todos.value
    }
  })
  /**
   * æ·»åŠ å¾…åŠäº‹é¡¹
   * @param todo ä»£åŠäº‹é¡¹
   */
  const addTodo = (todo: Todo) => {
    if (!todo) return
    todos.value.unshift(todo)
  }
  /**
   * åˆ é™¤å¾…åŠäº‹é¡¹
   * @param todo å¾…åŠäº‹é¡¹
   */
  const removeTodo = (todo: Todo) => {
    todos.value.splice(todos.value.indexOf(todo), 1)
  }
  /**
   * å…¨é€‰/åé€‰
   * @param completed æ˜¯å¦å®Œæˆ
   */
  const toggleAll = (completed: boolean) => {
    todos.value.forEach((todo) => (todo.completed = completed))
  }
  /**
   * æ¸…é™¤å·²å®Œæˆçš„å¾…åŠäº‹é¡¹
   */
  const clearCompleted = () => {
    todos.value = todos.value.filter((todo) => !todo.completed)
  }

  return {
    todos,
    activeTodos,
    completedTodos,
    filteredTodos,
    addTodo,
    removeTodo,
    toggleAll,
    clearCompleted
  }
})
```

```vue [TodoMain.vue] {6-7,12,17,24,26}
<script setup lang="ts">
import TodoItem from '@/components/TodoItem.vue'
import { storeToRefs } from 'pinia'
import { useTodosStore } from '@/stores/todos'

const { todos, filteredTodos } = storeToRefs(useTodosStore())
const { toggleAll } = useTodosStore()
</script>

<template>
  <!-- This section should be hidden by default and shown when there are todos -->
  <section class="main" v-show="todos.length">
    <input
      id="toggle-all"
      class="toggle-all"
      type="checkbox"
      @change="(e) => toggleAll((e.target as HTMLInputElement).checked)"
    />
    <label for="toggle-all">Mark all as complete</label>
    <ul class="todo-list">
      <!-- These are here just to show the structure of the list items -->
      <!-- List items should get the class `editing` when editing and `completed` when marked as completed -->
      <TodoItem
        v-for="(todo, index) in filteredTodos"
        :key="todo.id"
        v-model="filteredTodos[index]"
      />
    </ul>
  </section>
</template>

<style scoped></style>
```

```vue [TodoFooter.vue]
<script setup lang="ts">
import { useRoute } from 'vue-router'
import { storeToRefs } from 'pinia'
import { useTodosStore } from '@/stores/todos'

const route = useRoute()
const { todos, activeTodos, completedTodos } = storeToRefs(useTodosStore())
const { clearCompleted } = useTodosStore()
</script>

<template>
  <!-- This footer should be hidden by default and shown when there are todos -->
  <footer class="footer" v-show="todos.length">
    <!-- This should be `0 items left` by default -->
    <span class="todo-count"
      ><strong>{{ activeTodos.length }}</strong> item left</span
    >
    <!-- Remove this if you don't implement routing -->
    <ul class="filters">
      <li>
        <RouterLink to="/" :class="{ selected: route.name === 'all' }"> All </RouterLink>
      </li>
      <li>
        <RouterLink to="/active" :class="{ selected: route.name === 'active' }">
          Active
        </RouterLink>
      </li>
      <li>
        <RouterLink to="/completed" :class="{ selected: route.name === 'completed' }">
          Completed
        </RouterLink>
      </li>
    </ul>
    <!-- Hidden if no completed items are left â†“ -->
    <button class="clear-completed" v-show="completedTodos.length" @click="clearCompleted">
      Clear completed
    </button>
  </footer>
</template>

<style scoped></style>
```

:::

### æŒä¹…åŒ–å­˜å‚¨

ä½¿ç”¨ [VueUse](https://www.vueusejs.com/) ä¸­çš„ [`useStorage` å‡½æ•°](https://www.vueusejs.com/core/useStorage/)æ¥å£°æ˜ todos å“åº”å¼å¯¹è±¡ï¼Œè¿™æ ·åšçš„è¯ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç‚¹å¥½å¤„ï¼š

- å½“é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå…ˆä»æœ¬åœ°å­˜å‚¨ `localStorage` ä¸­è¯»å–å…ˆå‰å·²å­˜å‚¨çš„å¾…åŠäº‹é¡¹ï¼Œå¦‚æœè¯»å–ä¸åˆ°åˆ™åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„ï¼›
- å®æ—¶ç›‘å¬ todos çš„å˜åŒ–ï¼Œåªè¦å¾…åŠäº‹é¡¹åˆ—è¡¨çŠ¶æ€å‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œå°±ä¼šå°†å…¶æœ€æ–°æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ `localStorage` ä¸­ã€‚

å®ç°æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š

1. å®‰è£… VueUseï¼š`pnpm i @vueuse/core`

2. ä½¿ç”¨ï¼š

   ```ts {5,11}
   import { defineStore } from 'pinia'
   import { computed, type Ref, ref } from 'vue'
   import type { Todo } from '@/types/todos'
   import { useRoute } from 'vue-router'
   import { useStorage } from '@vueuse/core'
   
   export const useTodosStore = defineStore('todos', () => {
     // ...
     
     // å¾…åŠäº‹é¡¹åˆ—è¡¨
     const todos = useStorage('todos', [] as Todo[])
     
     // ...
   })
   ```
